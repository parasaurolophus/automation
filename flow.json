[
    {
        "id": "cf1c3c82db18ac13",
        "type": "tab",
        "label": "Controls",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0b58b958ed2dda42",
        "type": "tab",
        "label": "Timer",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "448b73182a92925c",
        "type": "tab",
        "label": "Shades",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d5996bce439cae5a",
        "type": "tab",
        "label": "Lighting",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "dcb190a34f9985d0",
        "type": "tab",
        "label": "PowerView",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0fd18332ac97df78",
        "type": "tab",
        "label": "Hue",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "aa89d7a203abe260",
        "type": "tab",
        "label": "Owntracks",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "df241ac327af880e",
        "type": "tab",
        "label": "Monitoring",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b903e4fc563d501c",
        "type": "subflow",
        "name": "Hue API V2",
        "info": "Interoperate with the Hue Bridge API V2",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 220,
                "wires": [
                    {
                        "id": "07d61ea24d59a251"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1480,
                "y": 400,
                "wires": [
                    {
                        "id": "a60ba77764dccdcf",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1480,
                "y": 480,
                "wires": [
                    {
                        "id": "b750046e7372198f",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1270,
                "y": 760,
                "wires": [
                    {
                        "id": "1b1610a871da8230",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": "",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "KEY",
                "type": "str",
                "value": "",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "TOPIC",
                "type": "str",
                "value": "",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-hue-api-v2",
            "type": "hue-api-v2",
            "version": "4.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Interoperate with the Hue Bridge API V2",
            "keywords": "node-red,philips-hue,hue,hue-api,hue-api-v2",
            "license": "MIT"
        },
        "color": "#D8BFD8",
        "inputLabels": [
            "request"
        ],
        "outputLabels": [
            "controls",
            "metadata",
            "readyState"
        ],
        "icon": "node-red/bridge.svg",
        "status": {
            "x": 1220,
            "y": 840,
            "wires": [
                {
                    "id": "049567b797139205",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "eaaca1e226cc9251",
        "type": "group",
        "z": "dcb190a34f9985d0",
        "name": "send message to powerview hub",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "70e42b6637f4c865",
            "413305fe8cf8bc16",
            "3b9aea255e25c86d",
            "450c11f088a3f9ee",
            "a250d71416af8250",
            "e0ad652b11e93160",
            "d27eec8b029c5bd5",
            "9f3e418cab152ae3",
            "1b3072d1d7c8560b"
        ],
        "x": 14,
        "y": 19,
        "w": 972,
        "h": 142,
        "info": "Send API command messages to a _PowerView_ hub at a rate of no more than\none per second."
    },
    {
        "id": "74348749d23b9082",
        "type": "group",
        "z": "dcb190a34f9985d0",
        "name": "fetch metadata from powerview hub",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "02eb116aa3a7efad",
            "a2ce2f10f0cbc3b4",
            "4597056c8e33d1d2",
            "a4b2cb7314b93cec",
            "e89d138990a2c571",
            "09ed6328f31946db",
            "a4115f1a663ecf84",
            "b3fa2dd0b396e5ba",
            "7379bd9759e06a98",
            "fa994326c2180556",
            "97d89691a9505bb9",
            "23ce9cde77523965",
            "ca455aa5752d94d8",
            "78a3fbe808d63c4c",
            "9950e52333199d8f",
            "b3b32f662f388893",
            "57c39b659f421513"
        ],
        "x": 14,
        "y": 179,
        "w": 1302,
        "h": 122,
        "info": "Dynamically create dashboard buttons corresponding to each scene\ndiscovered by querying a _PowerView_ hub."
    },
    {
        "id": "1858ee0bbe9b4418",
        "type": "group",
        "z": "0b58b958ed2dda42",
        "name": "send daily events",
        "style": {
            "label": true,
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "color": "#ffffff"
        },
        "nodes": [
            "b8e996d829493cf7",
            "aea41299ec309be7",
            "2172861d6eca2d1c",
            "ec4c72ab0b8b53ad",
            "cbcdf85a73052db5",
            "b42f1fba69cb70e0",
            "bf9f3e514e81d58c",
            "46ac71815281ccea",
            "da376bc386711c2d"
        ],
        "x": 14,
        "y": 19,
        "w": 992,
        "h": 202,
        "info": "Send daily events:\n\n1. Once at start up\n2. Each time a user changes the value of the _Bedtime_ dashboard\n   control\n3. Every morning at 1:01AM\n\nThe events sent periodically by this group of nodes are:\n\n| `msg.topic`        | `msg.payload`                                                                                             | Description                                                                           |\n|--------------------|-----------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n| `settings/bedtime` | Value selected by a user using the _Bedtime_ control on the dashboard                                     | Approximate hour at which \"night mode\" should begin each day                          |\n| `daily/theme`      | The _theme_string for the current day                                                                     | See the information for the `function` node named `theme` for more details            |\n| `daily/sunrise`    | Timestamp at which the sun rises on the current day                                                       | See the information for the `function` node named `sunrise | sunset` for more details |\n| `daily/sunset`     | Timestamp at which the sun sets on the current day                                                        | See the information for the `function` node named `sunrise | sunset` for more details |\n| `daily/bedtime`    | A timestamp that varies slightly each day, based on the value of the most recent `settings/bedtime` event | See the information for the `function` node named `bedtime` for more details          |\n\n**Note:** All three of the `function` nodes, `theme`, `sunrise | sunset`\nand `bedtime`, are downstream of a `join` node even though only one\nof them (`bedtime`) directly depends on both inputs to the `join`. This\nis deliberate. Blocking the `theme` and `sunrise | sunset` functions\nuntil after at least one message has been received from a `mqtt in`\nnode ensures that they will not attempt to send messages before the\nconnection to the MQTT broker is ready. This assumes that all of the\n`mqtt in` and `mqtt out` nodes on this flow use the same broker\nconfiguration node.\n\nThe alternative would be to add a `status` node for the relevant\n`mqtt out` node and another `join` node to synchronize the `function`\nnodes with the connection state."
    },
    {
        "id": "1afeb43be3175917",
        "type": "group",
        "z": "0b58b958ed2dda42",
        "name": "send timer events",
        "style": {
            "label": true,
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "color": "#ffffff"
        },
        "nodes": [
            "ce36e830ccb196af",
            "449c4612546c24a3",
            "795ddbf1ece0c9e6",
            "dde26fd5b0242b48",
            "91c56df5c885cf9f",
            "f5730fdb6bc0272f",
            "f901e2f89786bb1d"
        ],
        "x": 14,
        "y": 239,
        "w": 852,
        "h": 122,
        "info": "Send timer events over the course of each day:\n\n1. Once at start up\n2. At the start of each time of day as calculated by the `function` node\n   named `time`\n\nEach such message will have `msg.topic` set to `timer/time` and\n`msg.payload` set to one of the _time_ values:\n\n- `morning`\n- `midday`\n- `afternoon`\n- `evening`\n- `night`\n\nAgain, see the documentation for the `function` node named `time` for\nmore details."
    },
    {
        "id": "60e4d1c056ed3a0c",
        "type": "group",
        "z": "d5996bce439cae5a",
        "name": "trigger lighting automation",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "aae17e5a30471de5",
            "6c9be030a00c5cc6",
            "bc1635e58a89e806",
            "b9d34e86991d2a0a",
            "7a1a8616fdc104f8",
            "a3e04e2691a74b7b",
            "cb22b59dd606881c",
            "56997e0fe2cc9b78",
            "0e592700939a92aa",
            "ad19b78d51cf3749",
            "3c78c5af028bd8f2",
            "a06d578214f0220e",
            "01299c560124a4a8",
            "15bd957df9108fdf",
            "026fcd605d0c149f",
            "74c4f1b645e19b49",
            "ee5934ee53003d6d",
            "9368a43e0385a4cd",
            "81a28a8be63c7133",
            "6a90a040ad69d3e3",
            "2b807830184aa01f",
            "e8e26ac6a6ffd8f7",
            "5720dd9348b987ef",
            "4e1d20e601e89e22",
            "ece9e398ddf1a6a0",
            "a1ea5d860b770102",
            "070b96ef5945e392",
            "6312bc963e5b2aa0",
            "2d846e7736508ab1",
            "ea66991dc8d241d9",
            "124fdb28f37e82ee",
            "97fb90f6c4a4d450",
            "ab22f57d983c0a67"
        ],
        "x": 14,
        "y": 19,
        "w": 1352,
        "h": 762,
        "info": "Route `automation/trigger` event messages to invoke the appropriate\nlighting device control API's."
    },
    {
        "id": "5e4f33ee9bb4435b",
        "type": "group",
        "z": "448b73182a92925c",
        "name": "trigger window shades automation",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "37bac7a6b658ade4",
            "ec730ac674a50f58",
            "6a9ac472018c38ea",
            "c8c9c1f0d8b62902",
            "9e961b1409432775",
            "db4f7c2c93cd8f30",
            "146590f90eed7fb8",
            "ec26adec2aa94c40"
        ],
        "x": 14,
        "y": 19,
        "w": 902,
        "h": 202,
        "info": "Route `automation/trigger` event messages to invoke the appropriate\nwindow covering device control API's."
    },
    {
        "id": "70dad43254c6a458",
        "type": "group",
        "z": "b903e4fc563d501c",
        "name": "send messages to the hue bridge at a rate of no more than one per second",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "437ca2e5667c0391",
            "3b556984858fe751",
            "ccb8f8c4fd3333af",
            "a1a4ef6fbcea1cd4",
            "2dd6e02f993c8f04",
            "07d61ea24d59a251",
            "bbe59505ef8e9e1f",
            "90fdb9a186a95e61",
            "c9871eceb8d3ea77",
            "579603985dd5ba84",
            "7a4ba2d58e8e1f70"
        ],
        "x": 94,
        "y": 159,
        "w": 1192,
        "h": 182
    },
    {
        "id": "8669233b567d0ffd",
        "type": "group",
        "z": "0fd18332ac97df78",
        "name": "ground floor hue",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "168247b3760f4731",
            "92ec777b2c9dab97",
            "a6c65b71fb515b1e",
            "02f4c8bc756ccb0c",
            "0ba95e35bb2d883c",
            "a63d0a103c3194da",
            "06948582458b59fd"
        ],
        "env": [
            {
                "name": "ADDRESS",
                "value": "GROUND_FLOOR_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "GROUND_FLOOR_HUE_KEY",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "hue/ground-floor",
                "type": "str"
            }
        ],
        "x": 14,
        "y": 19,
        "w": 732,
        "h": 202
    },
    {
        "id": "eec9d001159e45dc",
        "type": "group",
        "z": "b903e4fc563d501c",
        "name": "subscribe to events sent by the hue bridge, forward them to the dashboard and mqtt",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "7e0cf896d463421a",
            "4ab229c77e4ce0fe",
            "5e36497f30cb3265",
            "5e338d73bb5c33fb",
            "964ed66cfe05da8b",
            "f7841898977deb1b",
            "a60ba77764dccdcf",
            "b750046e7372198f",
            "153449edfaf38a67",
            "bbf1e13fabc2641b",
            "7e48f675042d8b93",
            "5ed6402bdc19dd70",
            "d3e5044fe363855b",
            "80bbf467c351320f",
            "12f058cdadbb39ce",
            "5a1b87c5d08fa5d4",
            "6ce6327771b66664",
            "f564e0e7691828da",
            "d35cf3e04888b6b9"
        ],
        "x": 14,
        "y": 359,
        "w": 1392,
        "h": 302
    },
    {
        "id": "2828b8557c781733",
        "type": "group",
        "z": "b903e4fc563d501c",
        "name": "EventSource readyState",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "a18432dc72ef7481",
            "88fdf97c8453fefa",
            "f1c617ee84221e5f",
            "ca9146b1992e5f35",
            "789bb9be09a90181",
            "922a1e8c5440e399",
            "85a47c35d4b95b8e",
            "049567b797139205",
            "e0c09fd7a883718c",
            "1b1610a871da8230",
            "2fe7c19fa52da3b7",
            "094b3e2d8dd632e0"
        ],
        "x": 14,
        "y": 679,
        "w": 1172,
        "h": 242
    },
    {
        "id": "4cb1a57dd2d304af",
        "type": "group",
        "z": "0fd18332ac97df78",
        "name": "basement hue",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "1fa12506e964418e",
            "a85248aa620b8480",
            "3c8bdad58be0a70d",
            "603def2442931ab8",
            "d524a793f4547d6e",
            "05602f33073e8a40",
            "0de92d87eea1d6a5"
        ],
        "env": [
            {
                "name": "ADDRESS",
                "value": "BASEMENT_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "BASEMENT_HUE_KEY",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "hue/basement",
                "type": "str"
            }
        ],
        "x": 14,
        "y": 239,
        "w": 652,
        "h": 202
    },
    {
        "id": "878c5819aeaae260",
        "type": "group",
        "z": "b903e4fc563d501c",
        "name": "subscribe to hue commands sent as mqtt messages",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "878b32d9e6225a1c",
            "f9023663e78ba591",
            "7ba75af758c2013d",
            "9c4ced2e27936fea",
            "16d6f0ca8acf69c4",
            "786ac487aac960f8"
        ],
        "x": 14,
        "y": 939,
        "w": 1292,
        "h": 82
    },
    {
        "id": "9cf0457b813ca743",
        "type": "group",
        "z": "dcb190a34f9985d0",
        "name": "activate a powerview scene",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "aed6009fd524f819",
            "34eaa776ddc24669",
            "2bf099ec37e84bbc"
        ],
        "x": 854,
        "y": 319,
        "w": 452,
        "h": 82,
        "info": "Dynamically create dashboard buttons corresponding to each scene\ndiscovered by querying a _PowerView_ hub."
    },
    {
        "id": "414ede3ad60aa4f3",
        "type": "group",
        "z": "cf1c3c82db18ac13",
        "name": "(re-) generate dynamically created controls at start and each time the Refresh Controls button is pressed",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "ec72f5d7972d5730",
            "20ea1d5e7618a150",
            "bceded3979bc03fa",
            "118231644044af03",
            "94511d26864a6541"
        ],
        "x": 14,
        "y": 19,
        "w": 1112,
        "h": 82
    },
    {
        "id": "dda52c5106fb8861",
        "type": "group",
        "z": "cf1c3c82db18ac13",
        "name": "controls for automation settings",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "6c1bf6f4cbe33db3",
            "c7aad35be6d90342",
            "095ea8afc684110d",
            "42bc590b4062807a",
            "0b33271ac14c1ff6",
            "fc2ee8d91d1c42ab",
            "8df7e77f86099c14",
            "9e8493371584e638",
            "621de2937093648a"
        ],
        "x": 14,
        "y": 119,
        "w": 572,
        "h": 202
    },
    {
        "id": "d9442a5bf6d149a3",
        "type": "group",
        "z": "aa89d7a203abe260",
        "name": "send presence/occupied mqtt message",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "f0eb117cc0bc558d",
            "19dcdf7d30223dca",
            "d36a88f8fd2b4a57",
            "8d1539c58c9952e5"
        ],
        "x": 34,
        "y": 19,
        "w": 552,
        "h": 82
    },
    {
        "id": "8b901043dfb1d703",
        "type": "group",
        "z": "aa89d7a203abe260",
        "name": "subscribe to owntracks events",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "0fb98b609a89f6fa",
            "685f6658f1b43a67",
            "6fea95222365c815",
            "97929054211fde5f",
            "fa2e24914da356c4",
            "e55d94f2e2ad19b4"
        ],
        "x": 34,
        "y": 119,
        "w": 642,
        "h": 122
    },
    {
        "id": "16d1b9110bd0cbdb",
        "type": "group",
        "z": "0b58b958ed2dda42",
        "name": "send automation trigger events",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "b78ca3870996057b",
            "db918aec73c389bf",
            "f7a9a404781d1816",
            "1775708d2776c3ea",
            "8d7aa2cb7fd921ec",
            "4284d9ac08e3685e",
            "4b4227414715c1fc",
            "edd175e6511d1149",
            "164103646b36c7a9"
        ],
        "x": 14,
        "y": 379,
        "w": 872,
        "h": 322,
        "info": "Send `automation/shades` event when:\n\n- A new `timer/time` event is received, and\n- Window shade automation is enabled by users"
    },
    {
        "id": "3ee8e4ee3e9c4da0",
        "type": "group",
        "z": "cf1c3c82db18ac13",
        "name": "controls to request a mobile device location and send a notification using owntracks",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "67def1a786e36b67",
            "d3576c3839c080a0",
            "42dc7bccd274e666",
            "04ea40afe46e2c80",
            "8c1c48679ffd613a",
            "592b47e20d697390",
            "ac22a5ccfd15c2fc",
            "e4ab54f377c042be",
            "f83425064a2e8721",
            "d7ba25efa881e694",
            "119b57faaf3571bf"
        ],
        "x": 174,
        "y": 539,
        "w": 1092,
        "h": 167
    },
    {
        "id": "09d28341f4c50b5b",
        "type": "group",
        "z": "df241ac327af880e",
        "name": "monitoring",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "dedc6f621fe92832",
            "5c5154d5bead461b",
            "fa34b76e712ef007",
            "9130997453dbb01b",
            "9dbd2d38d6ceec1c",
            "fd0c567c69283354",
            "4001688ace8380e3",
            "e5d69dd29b21c14c",
            "518d5b3b737fb2b7",
            "1c34f9e60db8ac44",
            "f71d8c10fe85ef58",
            "8157178701101806",
            "33f3b49c352439c5",
            "a82e890fa79b420b",
            "6293131f50765462",
            "18d43f9fefe9624c",
            "0b56b8c38bfb3aba",
            "92c3731c8de659b7",
            "fc153f56d0c419cf"
        ],
        "x": 14,
        "y": 19,
        "w": 572,
        "h": 502
    },
    {
        "id": "08b2209541523df5",
        "type": "group",
        "z": "df241ac327af880e",
        "name": "metadata",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "7b9c4782e27fd2a6",
            "0a276a2f80958e1d",
            "7e752d52587770b0",
            "ad2e21f102e390a2",
            "a669fc8cf545698e",
            "ef07dd563fbd8f3f",
            "88c84a36afd0a577",
            "25d4e7cf8ec7c009",
            "18026fe8357838ab"
        ],
        "x": 194,
        "y": 539,
        "w": 392,
        "h": 202
    },
    {
        "id": "34cccb636739d850",
        "type": "group",
        "z": "cf1c3c82db18ac13",
        "name": "window shade controls",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "de8273a5bd63e29f",
            "eb7123132bce19c7",
            "74c9401c93a5c79f",
            "10fd922b445924e9",
            "58b1869eba4f1931",
            "65477d8ab7384f03"
        ],
        "x": 614,
        "y": 399,
        "w": 642,
        "h": 122
    },
    {
        "id": "51cc912ae0d47bc5",
        "type": "group",
        "z": "cf1c3c82db18ac13",
        "name": "ground floor lighting controls",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "093e3d281d19a300",
            "931a6bd2a9326bc9",
            "fbd24d6194c16d28",
            "c57f504fa2665937",
            "312ab67152201b30"
        ],
        "x": 694,
        "y": 119,
        "w": 592,
        "h": 122
    },
    {
        "id": "1b79bfde24d7c96e",
        "type": "group",
        "z": "aa89d7a203abe260",
        "name": "display occupants' location on map",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "276c2f875af67ff4",
            "35b218d3b52509fd",
            "99d49d9fa9a4b7b9",
            "13221e9154949946",
            "96b8c82fdeb0cc61",
            "71ce3f29ea878e53",
            "ebe4d9baab41f78e",
            "ec43fab9ca3811b0"
        ],
        "x": 34,
        "y": 259,
        "w": 1012,
        "h": 122
    },
    {
        "id": "3f10e06bbb25f60e",
        "type": "group",
        "z": "cf1c3c82db18ac13",
        "name": "basement lighting controls",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "317090b864c59aa9",
            "aede967dabee6adc",
            "0c55fa3270a1a251",
            "6b6cef6c3f496573",
            "8dd90b562d6eb844"
        ],
        "x": 694,
        "y": 259,
        "w": 552,
        "h": 122
    },
    {
        "id": "06bdd60cce319536",
        "type": "group",
        "z": "df241ac327af880e",
        "name": "",
        "style": {
            "stroke": "none",
            "fill": "#ffffff",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "a7cf1643a9332de2",
            "3bf82acf8b05bc31",
            "1af506ce07ba6b16",
            "43dededbad742ab8",
            "749b3deee816e422",
            "b999ac0934b6f741",
            "7a0af6f4a758942f"
        ],
        "x": 614,
        "y": 19,
        "w": 422,
        "h": 122
    },
    {
        "id": "9afb63c1c8bd4737",
        "type": "group",
        "z": "aa89d7a203abe260",
        "name": "EXPERIMENTAL: subscribe only to those topics designated by ${OWNTRACKS_TOPICS}",
        "style": {
            "stroke": "none",
            "fill": "#ff0000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#ff0000"
        },
        "nodes": [
            "62646295b2e7d915",
            "81782b142dd085ec",
            "4b56ea14719d7d6a",
            "206ca94c86f8c312",
            "3db6b246859868ee",
            "03536dd6672f267f"
        ],
        "x": 34,
        "y": 399,
        "w": 892,
        "h": 82
    },
    {
        "id": "85a47c35d4b95b8e",
        "type": "junction",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "x": 860,
        "y": 800,
        "wires": [
            [
                "049567b797139205",
                "e0c09fd7a883718c"
            ]
        ]
    },
    {
        "id": "ad19b78d51cf3749",
        "type": "junction",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "x": 820,
        "y": 240,
        "wires": [
            [
                "15bd957df9108fdf",
                "026fcd605d0c149f"
            ]
        ]
    },
    {
        "id": "3c78c5af028bd8f2",
        "type": "junction",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "x": 820,
        "y": 340,
        "wires": [
            [
                "74c4f1b645e19b49",
                "ee5934ee53003d6d"
            ]
        ]
    },
    {
        "id": "a06d578214f0220e",
        "type": "junction",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "x": 840,
        "y": 440,
        "wires": [
            [
                "9368a43e0385a4cd",
                "81a28a8be63c7133"
            ]
        ]
    },
    {
        "id": "01299c560124a4a8",
        "type": "junction",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "x": 820,
        "y": 540,
        "wires": [
            [
                "6a90a040ad69d3e3",
                "2b807830184aa01f"
            ]
        ]
    },
    {
        "id": "070b96ef5945e392",
        "type": "junction",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "x": 600,
        "y": 700,
        "wires": [
            [
                "5720dd9348b987ef",
                "4e1d20e601e89e22",
                "a1ea5d860b770102"
            ]
        ]
    },
    {
        "id": "97fb90f6c4a4d450",
        "type": "junction",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "x": 600,
        "y": 100,
        "wires": [
            [
                "6312bc963e5b2aa0",
                "2d846e7736508ab1",
                "ea66991dc8d241d9"
            ]
        ]
    },
    {
        "id": "f83425064a2e8721",
        "type": "junction",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "x": 680,
        "y": 680,
        "wires": [
            [
                "d7ba25efa881e694"
            ]
        ]
    },
    {
        "id": "d7ba25efa881e694",
        "type": "junction",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "x": 820,
        "y": 680,
        "wires": [
            [
                "592b47e20d697390"
            ]
        ]
    },
    {
        "id": "cebfc098dc83e835",
        "type": "mqtt-broker",
        "name": "",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "7a427ced50896e29",
        "type": "ui_tab",
        "name": "Controls",
        "icon": "fa-dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a06ff030ec526ee1",
        "type": "ui_base",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#097479",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#0eb8c0",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "dark"
            }
        },
        "site": {
            "name": "Automation",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "MM/DD/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "f1c37b89696920be",
        "type": "ui_tab",
        "name": "Metadata",
        "icon": "fa-info",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "bad6261ac75df85d",
        "type": "ui_group",
        "name": "Window Shades",
        "tab": "7a427ced50896e29",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "9c75181f2c63c679",
        "type": "ui_group",
        "name": "Shades",
        "tab": "f1c37b89696920be",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "ec2b1aad4d84307c",
        "type": "ui_group",
        "name": "Settings",
        "tab": "7a427ced50896e29",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "62fb9b437a9f6bcf",
        "type": "ui_group",
        "name": "Monitor",
        "tab": "7a427ced50896e29",
        "order": 6,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "a466343d83180c88",
        "type": "tls-config",
        "z": "b903e4fc563d501c",
        "name": "ignore certificate",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "6865fdd160367b37",
        "type": "ui_group",
        "name": "Ground Floor",
        "tab": "7a427ced50896e29",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "572765d576e80a9f",
        "type": "ui_group",
        "name": "Ground Floor",
        "tab": "f1c37b89696920be",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "2b9d72b934dccd62",
        "type": "ui_group",
        "name": "Basement",
        "tab": "7a427ced50896e29",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "b92e09ec548c4465",
        "type": "ui_group",
        "name": "Basement",
        "tab": "f1c37b89696920be",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "b09c5f604dc0ccfc",
        "type": "ui_link",
        "name": "Map",
        "link": "../worldmap",
        "icon": "fa-globe",
        "target": "newtab",
        "order": 3
    },
    {
        "id": "a889040240562d1d",
        "type": "ui_group",
        "name": "Presence",
        "tab": "7a427ced50896e29",
        "order": 5,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "6432938dc45a0f1b",
        "type": "ui_group",
        "name": "Owntracks",
        "tab": "f1c37b89696920be",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "437ca2e5667c0391",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'https://' & $env('ADDRESS') & '/clip/v2/' & topic",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\t   \"hue-application-key\": $env('KEY')\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 240,
        "wires": [
            [
                "ccb8f8c4fd3333af"
            ]
        ]
    },
    {
        "id": "3b556984858fe751",
        "type": "link out",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "response",
        "mode": "return",
        "links": [],
        "x": 975,
        "y": 200,
        "wires": []
    },
    {
        "id": "ccb8f8c4fd3333af",
        "type": "http request",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "body",
        "url": "",
        "tls": "a466343d83180c88",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 610,
        "y": 240,
        "wires": [
            [
                "a1a4ef6fbcea1cd4",
                "2dd6e02f993c8f04"
            ]
        ]
    },
    {
        "id": "a1a4ef6fbcea1cd4",
        "type": "function",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "validate",
        "func": "if (!Number.isInteger(msg.statusCode)) {\n\n    return msg\n\n}\n\nif ((msg.statusCode < 200) || (msg.statusCode >= 300)) {\n\n    return msg\n\n}\n\nif (!Object.prototype.hasOwnProperty.call(msg.payload, 'data')) {\n\n    return msg\n\n}\n\n// should check msg.errors but that is untenable due to defects in the Hue Bridge API\n\nreturn null",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 280,
        "wires": [
            [
                "bbe59505ef8e9e1f",
                "90fdb9a186a95e61"
            ]
        ]
    },
    {
        "id": "2dd6e02f993c8f04",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.data",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 200,
        "wires": [
            [
                "3b556984858fe751"
            ]
        ]
    },
    {
        "id": "07d61ea24d59a251",
        "type": "delay",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 270,
        "y": 240,
        "wires": [
            [
                "437ca2e5667c0391"
            ]
        ]
    },
    {
        "id": "7e0cf896d463421a",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"url\":\"https://\" & $env('ADDRESS') & \"/eventstream/clip/v2\",\t   \"initDict\":{\t       \"withCredentials\": false,\t       \"https\": { \"rejectUnauthorized\":false },\t       \"headers\": { \"hue-application-key\": $env('KEY') }\t   }\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 540,
        "wires": [
            [
                "153449edfaf38a67"
            ]
        ]
    },
    {
        "id": "4ab229c77e4ce0fe",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "${TOPIC}/onopen",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 560,
        "wires": [
            [
                "964ed66cfe05da8b"
            ]
        ]
    },
    {
        "id": "5e36497f30cb3265",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "${TOPIC}/onerror",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 620,
        "wires": [
            [
                "964ed66cfe05da8b"
            ]
        ]
    },
    {
        "id": "5e338d73bb5c33fb",
        "type": "function",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "persist data",
        "func": "const TOPIC = env.get('TOPIC') || 'hue'\nconst resources = flow.get('resources')\nconst data = JSON.parse(msg.payload.data)\n\nconst messages = []\n\nfor (let datum of data) {\n\n    for (let value of datum.data) {\n\n        const category = resources[value.type] || {}\n        let resource = category[value.id] || {}\n\n        switch (datum.type) {\n\n            case 'add':\n            case 'update':\n\n                for (let property in value) {\n\n                    resource[property] = value[property]\n                }\n\n                break\n\n            case 'delete':\n\n                delete category[value.id]\n                break\n\n            default:\n\n                node.warn(JSON.stringify(datum, undefined, 1))\n                break\n\n        }\n\n        category[value.id] = resource\n        resources[value.type] = category\n\n        const message = RED.util.cloneMessage(msg)\n\n        message.payload = resource\n        message.topic = TOPIC + '/resource/' + value.type + '/' + value.id\n        messages.push(message)\n\n    }\n}\n\nflow.set('resources', resources)\n\nmsg.payload = resources\n\nreturn [\n    msg,\n    messages\n]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 500,
        "wires": [
            [
                "f7841898977deb1b"
            ],
            [
                "964ed66cfe05da8b"
            ]
        ],
        "outputLabels": [
            "resources",
            "mqtt"
        ]
    },
    {
        "id": "964ed66cfe05da8b",
        "type": "rbe",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1050,
        "y": 560,
        "wires": [
            [
                "bbf1e13fabc2641b"
            ]
        ]
    },
    {
        "id": "f7841898977deb1b",
        "type": "function",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "model",
        "func": "const model = []\n\nfunction findOwner(grouped_light) {\n\n    const groups = msg.payload[grouped_light.owner.rtype]\n\n    if (Object.prototype.hasOwnProperty.call(groups, grouped_light.owner.rid)) {\n\n        return groups[grouped_light.owner.rid]\n\n    }\n\n    throw 'no container found for grouped_light ' + grouped_light.id\n\n}\n\nfunction findScenes(owner) {\n\n    const scenes = []\n\n    for (let sceneId in msg.payload.scene) {\n\n        const scene = msg.payload.scene[sceneId]\n\n        if (scene.group.rid == owner.id) {\n\n            scenes.push(scene)\n\n        }\n    }\n\n    return scenes.sort((a, b) => {\n        return a.metadata.name.localeCompare(b.metadata.name)\n    })\n\n}\n\nfor (let grouped_light_id in msg.payload.grouped_light) {\n\n    const grouped_light = msg.payload.grouped_light[grouped_light_id]\n    const owner = findOwner(grouped_light)\n    const scenes = findScenes(owner)\n\n    model.push({\n        grouped_light: grouped_light,\n        owner: owner,\n        scenes: scenes,\n        name: (owner.metadata ? owner.metadata.name : 'All Lights')\n    })\n\n}\n\nmsg.payload = model.sort((a, b) => {\n    return a.name.localeCompare(b.name)\n})\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 440,
        "wires": [
            [
                "d35cf3e04888b6b9"
            ]
        ]
    },
    {
        "id": "a60ba77764dccdcf",
        "type": "template",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "controls",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "plain",
        "template": "<div style=\"text-align: center;\">\n    <div ng-repeat=\"model in msg.payload\">\n        <hr>\n        <md-switch style=\"margin-left: 1em;\" ng-value=\"model.grouped_light.on.on\" ng-model=\"model.grouped_light.on.on\"\n            ng-change=\"send({ topic: 'resource/grouped_light/' + model.grouped_light.id, payload: { on: { on:model.grouped_light.on.on } }, method: 'PUT' })\">\n            {{model.name}}\n        </md-switch>\n        <md-button style=\"display: inline-block; margin: 1px\" ng-repeat=\"scene in model.scenes\"\n            ng-click=\"send({topic: 'resource/scene/' + scene.id, payload: {recall:{action:'dynamic_palette'}}, method: 'PUT'})\">\n            {{scene.metadata.name}}\n        </md-button>\n    </div>\n</div>",
        "output": "str",
        "x": 1320,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "b750046e7372198f",
        "type": "template",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "metadata",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "plain",
        "template": "<div>\n    <div ng-repeat=\"model in msg.payload\">\n        <hr ng-if=\"$index > 0\">\n        <dl>\n            <dt>{{model.name}}</dt>\n            <dd>\n                {{model.grouped_light.id}}\n                <dl ng-repeat=\"scene in model.scenes\">\n                    <dt>{{scene.metadata.name}}</dt>\n                    <dd>{{scene.id}}</dd>\n                </dl>\n            </dd>\n        </dl>\n    </div>\n</div>",
        "output": "str",
        "x": 1320,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "d3e5044fe363855b",
        "type": "function",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "format event",
        "func": "// clear out cached resources\nflow.set('resources', {})\n\nconst updates = [{ type: 'update', data: msg.payload }]\nconst event = { type: 'message', data: JSON.stringify(updates) }\n\nmsg.payload = event\nmsg.topic = 'message'\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 460,
        "wires": [
            [
                "5e338d73bb5c33fb"
            ]
        ],
        "outputLabels": [
            "ready"
        ]
    },
    {
        "id": "80bbf467c351320f",
        "type": "link call",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "links": [
            "7a4ba2d58e8e1f70"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 520,
        "y": 460,
        "wires": [
            [
                "d3e5044fe363855b"
            ]
        ]
    },
    {
        "id": "12f058cdadbb39ce",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "request",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "GET",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 460,
        "wires": [
            [
                "80bbf467c351320f"
            ]
        ]
    },
    {
        "id": "2fe7c19fa52da3b7",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "$number(status.text)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$number(status.text)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 800,
        "wires": [
            [
                "a18432dc72ef7481"
            ]
        ]
    },
    {
        "id": "a18432dc72ef7481",
        "type": "switch",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "-1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 510,
        "y": 800,
        "wires": [
            [
                "88fdf97c8453fefa"
            ],
            [
                "f1c617ee84221e5f"
            ],
            [
                "ca9146b1992e5f35"
            ],
            [
                "789bb9be09a90181"
            ],
            [
                "922a1e8c5440e399"
            ]
        ],
        "info": "Select the string representation of `EventSource.readyState` based on\nits numeric value."
    },
    {
        "id": "88fdf97c8453fefa",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "Unitialized",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Unitialized",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "icon",
                "pt": "msg",
                "to": "<i class=\"fa fa-circle-o\"></i>",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "color",
                "pt": "msg",
                "to": "blue",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 720,
        "wires": [
            [
                "85a47c35d4b95b8e"
            ]
        ]
    },
    {
        "id": "f1c617ee84221e5f",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "Connecting",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Connecting",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "icon",
                "pt": "msg",
                "to": "<i class=\"fa fa-circle-o-notch fa-spin fa-fw\"></i>",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "color",
                "pt": "msg",
                "to": "yellow",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 760,
        "wires": [
            [
                "85a47c35d4b95b8e"
            ]
        ],
        "info": "Set `msg.payload`, `msg.icon` and `msg.color` corresponding to\nthe `EventSource.readyState` value 0, (_connecting_)."
    },
    {
        "id": "ca9146b1992e5f35",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "Connected",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Connected",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "icon",
                "pt": "msg",
                "to": "<i class=\"fa fa-circle\"></i>",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "color",
                "pt": "msg",
                "to": "green",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 800,
        "wires": [
            [
                "85a47c35d4b95b8e"
            ]
        ],
        "info": "Set `msg.payload`, `msg.icon` and `msg.color` corresponding to\nthe `EventSource.readyState` value 1, (_connected_)."
    },
    {
        "id": "789bb9be09a90181",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "Failed",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Failed",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "icon",
                "pt": "msg",
                "to": "<i class=\"fa fa-circle-o\"></i>",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "color",
                "pt": "msg",
                "to": "red",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 840,
        "wires": [
            [
                "85a47c35d4b95b8e"
            ]
        ],
        "info": "Set `msg.payload`, `msg.icon` and `msg.color` corresponding to\nthe `EventSource.readyState` value 2, (_failed_)."
    },
    {
        "id": "922a1e8c5440e399",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "Invalid",
        "rules": [
            {
                "t": "set",
                "p": "icon",
                "pt": "msg",
                "to": "<i class=\"fa fa-ban\"></i>",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "color",
                "pt": "msg",
                "to": "grey",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 880,
        "wires": [
            [
                "85a47c35d4b95b8e"
            ]
        ],
        "info": "Set `msg.payload`, `msg.icon` and `msg.color` corresponding to any\nunsupported value of `EventSource.readyState`."
    },
    {
        "id": "049567b797139205",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"text\":payload,\t   \"shape\":status.shape,\t   \"fill\":color\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 840,
        "wires": [
            []
        ],
        "info": "Convert the string representation of the `EventSource.readyState` back\ninto this subflow's status."
    },
    {
        "id": "e0c09fd7a883718c",
        "type": "template",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "html",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<div style=\"margin: 0; position: relative; width: 100%; height: 100%;\">\n    <div style=\"margin: 0; position: absolute; top: 50%; transform: translateY(-50%); width: 100%;\">\n        <table style=\"width: 100%;\">\n            <tr>\n                <td style=\"width: 15%; padding: 0 0 0 1em; color: {{color}}\">{{{icon}}}</td>\n                <td>{{payload}}</td>\n            </tr>\n        </table>\n    </div>\n</div>",
        "output": "str",
        "x": 950,
        "y": 760,
        "wires": [
            [
                "1b1610a871da8230"
            ]
        ],
        "info": "Set `msg.payload`, `msg.icon` and `msg.color` corresponding to\nthe `EventSource.readyState` value -1, (_unitialized_)."
    },
    {
        "id": "1b1610a871da8230",
        "type": "delay",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1090,
        "y": 760,
        "wires": [
            []
        ],
        "info": "Limit the rate at which state-change messages are sent, as an aid in\ndebugging."
    },
    {
        "id": "153449edfaf38a67",
        "type": "EventSource",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "x": 690,
        "y": 560,
        "wires": [
            [
                "5e338d73bb5c33fb"
            ],
            [
                "4ab229c77e4ce0fe"
            ],
            [
                "5e36497f30cb3265"
            ]
        ]
    },
    {
        "id": "094b3e2d8dd632e0",
        "type": "status",
        "z": "b903e4fc563d501c",
        "g": "2828b8557c781733",
        "name": "status: Event Source",
        "scope": [
            "153449edfaf38a67"
        ],
        "x": 130,
        "y": 800,
        "wires": [
            [
                "2fe7c19fa52da3b7"
            ]
        ]
    },
    {
        "id": "bbf1e13fabc2641b",
        "type": "mqtt out",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 1170,
        "y": 560,
        "wires": []
    },
    {
        "id": "7e48f675042d8b93",
        "type": "mqtt in",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "topic": "controls/refresh",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 400,
        "y": 580,
        "wires": [
            [
                "5ed6402bdc19dd70"
            ]
        ]
    },
    {
        "id": "f9023663e78ba591",
        "type": "status",
        "z": "b903e4fc563d501c",
        "g": "878c5819aeaae260",
        "name": "status: mqtt in",
        "scope": [
            "9c4ced2e27936fea"
        ],
        "x": 110,
        "y": 980,
        "wires": [
            [
                "878b32d9e6225a1c"
            ]
        ]
    },
    {
        "id": "878b32d9e6225a1c",
        "type": "switch",
        "z": "b903e4fc563d501c",
        "g": "878c5819aeaae260",
        "name": "node-red:common.status.connected",
        "property": "status.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "node-red:common.status.connected",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 340,
        "y": 980,
        "wires": [
            [
                "7ba75af758c2013d"
            ]
        ]
    },
    {
        "id": "7ba75af758c2013d",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "878c5819aeaae260",
        "name": "subscribe",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "subscribe",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "[\t   {\t       \"topic\": 'put/' & $env('TOPIC') & '/resource/+/+',\t       \"qos\": 2\t   }\t]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 980,
        "wires": [
            [
                "9c4ced2e27936fea"
            ]
        ]
    },
    {
        "id": "9c4ced2e27936fea",
        "type": "mqtt in",
        "z": "b903e4fc563d501c",
        "g": "878c5819aeaae260",
        "name": "put/${TOPIC}/resource/+/+",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 750,
        "y": 980,
        "wires": [
            [
                "16d6f0ca8acf69c4"
            ]
        ]
    },
    {
        "id": "16d6f0ca8acf69c4",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "878c5819aeaae260",
        "name": "set command properties",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "$substringAfter(topic, 'put/' & $env('TOPIC') & '/')\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 980,
        "wires": [
            [
                "786ac487aac960f8"
            ]
        ]
    },
    {
        "id": "786ac487aac960f8",
        "type": "link call",
        "z": "b903e4fc563d501c",
        "g": "878c5819aeaae260",
        "name": "",
        "links": [
            "7a4ba2d58e8e1f70"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1200,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "429c5d451e73036e",
        "type": "comment",
        "z": "b903e4fc563d501c",
        "name": "https://github.com/parasaurolophus/create-hue-application-key",
        "info": "",
        "x": 260,
        "y": 80,
        "wires": []
    },
    {
        "id": "4618e940bf9ae3a5",
        "type": "comment",
        "z": "b903e4fc563d501c",
        "name": "https://developers.meethue.com/develop/hue-api-v2/",
        "info": "",
        "x": 230,
        "y": 40,
        "wires": []
    },
    {
        "id": "5ed6402bdc19dd70",
        "type": "change",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "close",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 580,
        "wires": [
            [
                "153449edfaf38a67"
            ]
        ]
    },
    {
        "id": "5a1b87c5d08fa5d4",
        "type": "delay",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 220,
        "y": 460,
        "wires": [
            [
                "12f058cdadbb39ce"
            ]
        ]
    },
    {
        "id": "5a5dcfc92a3d649f",
        "type": "comment",
        "z": "b903e4fc563d501c",
        "name": "https://www.npmjs.com/package/@parasaurolophus/node-red-eventsource",
        "info": "",
        "x": 300,
        "y": 120,
        "wires": []
    },
    {
        "id": "90fdb9a186a95e61",
        "type": "function",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "stringify",
        "func": "msg.payload = JSON.stringify(msg, undefined, 1)\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 260,
        "wires": [
            [
                "c9871eceb8d3ea77"
            ]
        ],
        "info": "Pretty-print `msg.payload`."
    },
    {
        "id": "c9871eceb8d3ea77",
        "type": "template",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "<pre>",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<div>\n    <pre>{{payload}}</pre>\n</div>",
        "output": "str",
        "x": 1050,
        "y": 260,
        "wires": [
            [
                "579603985dd5ba84"
            ]
        ],
        "info": "Wrap `msg.payload` in HTML."
    },
    {
        "id": "579603985dd5ba84",
        "type": "ui_toast",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1190,
        "y": 260,
        "wires": [
            []
        ],
        "info": "Display the HTML snippet as a \"toast\" on the dashboard."
    },
    {
        "id": "bbe59505ef8e9e1f",
        "type": "debug",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "hue error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 300,
        "wires": []
    },
    {
        "id": "6ce6327771b66664",
        "type": "complete",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "format event",
        "scope": [
            "d3e5044fe363855b"
        ],
        "uncaught": false,
        "x": 410,
        "y": 540,
        "wires": [
            [
                "7e0cf896d463421a"
            ]
        ]
    },
    {
        "id": "f564e0e7691828da",
        "type": "complete",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "close",
        "scope": [
            "5ed6402bdc19dd70"
        ],
        "uncaught": false,
        "x": 90,
        "y": 460,
        "wires": [
            [
                "5a1b87c5d08fa5d4"
            ]
        ]
    },
    {
        "id": "7a4ba2d58e8e1f70",
        "type": "link in",
        "z": "b903e4fc563d501c",
        "g": "70dad43254c6a458",
        "name": "send to bridge",
        "links": [],
        "x": 135,
        "y": 280,
        "wires": [
            [
                "07d61ea24d59a251"
            ]
        ]
    },
    {
        "id": "d35cf3e04888b6b9",
        "type": "rbe",
        "z": "b903e4fc563d501c",
        "g": "eec9d001159e45dc",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 1170,
        "y": 440,
        "wires": [
            [
                "b750046e7372198f",
                "a60ba77764dccdcf"
            ]
        ]
    },
    {
        "id": "ec72f5d7972d5730",
        "type": "status",
        "z": "cf1c3c82db18ac13",
        "g": "414ede3ad60aa4f3",
        "name": "status: controls/refresh",
        "scope": [
            "94511d26864a6541"
        ],
        "x": 140,
        "y": 60,
        "wires": [
            [
                "20ea1d5e7618a150"
            ]
        ],
        "info": "Subscribe to status messages from the `mqtt out` node downstream."
    },
    {
        "id": "20ea1d5e7618a150",
        "type": "switch",
        "z": "cf1c3c82db18ac13",
        "g": "414ede3ad60aa4f3",
        "name": "node-red:common.status.connected",
        "property": "status.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "node-red:common.status.connected",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 400,
        "y": 60,
        "wires": [
            [
                "bceded3979bc03fa"
            ]
        ],
        "info": "Block unless `msg.status.text` indicates that the `mqtt out` node is\nconnected to the broker."
    },
    {
        "id": "bceded3979bc03fa",
        "type": "change",
        "z": "cf1c3c82db18ac13",
        "g": "414ede3ad60aa4f3",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 60,
        "wires": [
            [
                "118231644044af03"
            ]
        ],
        "info": "Set `msg.payload` to the current timestamp so that the `ui_button` will\nbe triggered."
    },
    {
        "id": "118231644044af03",
        "type": "ui_button",
        "z": "cf1c3c82db18ac13",
        "g": "414ede3ad60aa4f3",
        "name": "",
        "group": "ec2b1aad4d84307c",
        "order": 1,
        "width": "0",
        "height": "0",
        "passthru": true,
        "label": "Refresh Controls",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "date",
        "topic": "controls/refresh",
        "topicType": "str",
        "x": 830,
        "y": 60,
        "wires": [
            [
                "94511d26864a6541"
            ]
        ],
        "info": "Send a message with `msg.topic` set to `controls/refresh` and\n`msg.payload` set to the current timestamp each time this button is\ntriggered."
    },
    {
        "id": "94511d26864a6541",
        "type": "mqtt out",
        "z": "cf1c3c82db18ac13",
        "g": "414ede3ad60aa4f3",
        "name": "",
        "topic": "controls/refresh",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 1020,
        "y": 60,
        "wires": [],
        "info": "Broadcast a `controls/refresh` message using MQTT."
    },
    {
        "id": "8df7e77f86099c14",
        "type": "mqtt in",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "topic": "settings/lighting",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 280,
        "wires": [
            [
                "9e8493371584e638"
            ]
        ],
        "info": "Subscribe to `settings/lighting` messages using MQTT."
    },
    {
        "id": "9e8493371584e638",
        "type": "ui_switch",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "label": "Enable Lighting",
        "tooltip": "",
        "group": "ec2b1aad4d84307c",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "settings/lighting",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 300,
        "y": 280,
        "wires": [
            [
                "621de2937093648a"
            ]
        ],
        "info": "Dashboard control to enable or disable lighting automation."
    },
    {
        "id": "621de2937093648a",
        "type": "mqtt out",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "topic": "settings/lighting",
        "qos": "2",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 480,
        "y": 280,
        "wires": [],
        "info": "Send user interaction as an event message using MQTT."
    },
    {
        "id": "42bc590b4062807a",
        "type": "mqtt in",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "topic": "settings/shades",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 220,
        "wires": [
            [
                "0b33271ac14c1ff6"
            ]
        ],
        "info": "Subscribe to `settings/shades` messages using MQTT."
    },
    {
        "id": "0b33271ac14c1ff6",
        "type": "ui_switch",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "label": "Enable Shades",
        "tooltip": "",
        "group": "ec2b1aad4d84307c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "settings/shades",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 300,
        "y": 220,
        "wires": [
            [
                "fc2ee8d91d1c42ab"
            ]
        ],
        "info": "Dashboard control to enable or disable window shades automation."
    },
    {
        "id": "fc2ee8d91d1c42ab",
        "type": "mqtt out",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "topic": "settings/shades",
        "qos": "2",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 480,
        "y": 220,
        "wires": [],
        "info": "Send user interaction as an event message using MQTT."
    },
    {
        "id": "6c1bf6f4cbe33db3",
        "type": "mqtt in",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "topic": "settings/bedtime",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 160,
        "wires": [
            [
                "c7aad35be6d90342"
            ]
        ],
        "info": "Subscribe to `settings/bedtime` messages from the MQTT broker. See the\ndocumentation for the _Bedtime_ dashboard control for more information."
    },
    {
        "id": "c7aad35be6d90342",
        "type": "ui_dropdown",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "Bedtime Setting",
        "label": "Bedtime",
        "tooltip": "",
        "place": "Select option",
        "group": "ec2b1aad4d84307c",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "9PM",
                "value": 21,
                "type": "num"
            },
            {
                "label": "10PM",
                "value": "22",
                "type": "str"
            },
            {
                "label": "11PM",
                "value": "23",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "settings/bedtime",
        "topicType": "str",
        "className": "",
        "x": 300,
        "y": 160,
        "wires": [
            [
                "095ea8afc684110d"
            ]
        ],
        "info": "Allow a user to select 9PM, 10PM or 11PM as the base time for the value\nof the `daily/bedtime` event each day. See the documentation of the\n`function` node named `bedtime` for more information on how this\nsetting is used to calculate a random value for `daily/bedtime`."
    },
    {
        "id": "095ea8afc684110d",
        "type": "mqtt out",
        "z": "cf1c3c82db18ac13",
        "g": "dda52c5106fb8861",
        "name": "",
        "topic": "settings/bedtime",
        "qos": "2",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 480,
        "y": 160,
        "wires": [],
        "info": "Send user interaction as an event message using MQTT."
    },
    {
        "id": "67def1a786e36b67",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "group": "a889040240562d1d",
        "name": "Request Location",
        "order": 1,
        "width": "6",
        "height": "2",
        "format": "<div style=\"width: 100%;\">\n    <md-button style=\"width: 100%;\" ng-repeat=\"model in msg.payload\"\n        ng-click=\"send({ topic: model.topic + '/cmd', payload: { _type: 'cmd', action: 'reportLocation' }})\">\n        Request {{model.name}} Location\n    </md-button>\n </div>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 570,
        "y": 580,
        "wires": [
            [
                "42dc7bccd274e666"
            ]
        ]
    },
    {
        "id": "d3576c3839c080a0",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "group": "a889040240562d1d",
        "name": "Send Notification",
        "order": 2,
        "width": "6",
        "height": "2",
        "format": "<div style=\"width: 100%;\">\n    <md-button style=\"width: 100%;\" ng-repeat=\"model in msg.payload\"\n        ng-click=\"send({ topic: model.topic + '/cmd', payload: 'Text:'})\">\n        Notify {{model.name}}\n    </md-button>\n </div>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 570,
        "y": 660,
        "wires": [
            [
                "04ea40afe46e2c80",
                "f83425064a2e8721"
            ]
        ]
    },
    {
        "id": "42dc7bccd274e666",
        "type": "mqtt out",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "name": "",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 730,
        "y": 580,
        "wires": []
    },
    {
        "id": "04ea40afe46e2c80",
        "type": "ui_toast",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "OK",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "notification",
        "name": "",
        "x": 750,
        "y": 640,
        "wires": [
            [
                "592b47e20d697390"
            ]
        ]
    },
    {
        "id": "8c1c48679ffd613a",
        "type": "link in",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "name": "dashboard",
        "links": [
            "fa2e24914da356c4",
            "a493346ae9aca541"
        ],
        "x": 215,
        "y": 620,
        "wires": [
            [
                "119b57faaf3571bf"
            ]
        ]
    },
    {
        "id": "592b47e20d697390",
        "type": "join",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 890,
        "y": 660,
        "wires": [
            [
                "ac22a5ccfd15c2fc"
            ]
        ]
    },
    {
        "id": "ac22a5ccfd15c2fc",
        "type": "function",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "name": "owntracks cmd",
        "func": "const payload = { _type: 'cmd', action: 'action' }\n\nfor (let topic in msg.payload) {\n\n    if (topic == 'notification') {\n\n        payload.notification = msg.payload.notification\n\n    } else {\n\n        msg.topic = topic\n\n    }\n}\n\nmsg.payload = payload\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 660,
        "wires": [
            [
                "e4ab54f377c042be"
            ]
        ]
    },
    {
        "id": "e4ab54f377c042be",
        "type": "mqtt out",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "name": "",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 1190,
        "y": 660,
        "wires": []
    },
    {
        "id": "093e3d281d19a300",
        "type": "link in",
        "z": "cf1c3c82db18ac13",
        "g": "51cc912ae0d47bc5",
        "name": "ground floor hue controls",
        "links": [
            "06948582458b59fd"
        ],
        "x": 735,
        "y": 200,
        "wires": [
            [
                "931a6bd2a9326bc9"
            ]
        ]
    },
    {
        "id": "931a6bd2a9326bc9",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "51cc912ae0d47bc5",
        "group": "6865fdd160367b37",
        "name": "Ground Floor Hue Controls",
        "order": 2,
        "width": "6",
        "height": "30",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 900,
        "y": 200,
        "wires": [
            [
                "fbd24d6194c16d28"
            ]
        ]
    },
    {
        "id": "fbd24d6194c16d28",
        "type": "link call",
        "z": "cf1c3c82db18ac13",
        "g": "51cc912ae0d47bc5",
        "name": "",
        "links": [
            "92ec777b2c9dab97"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1150,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "de8273a5bd63e29f",
        "type": "function",
        "z": "cf1c3c82db18ac13",
        "g": "34cccb636739d850",
        "name": "powerview model",
        "func": "msg.dashboard = []\n\nfunction findScenes(roomId) {\n\n    const scenes = []\n\n    for (const scene of msg.payload.scenes) {\n\n        if (scene.roomId == roomId) {\n\n            scenes.push(scene)\n\n        }\n    }\n\n    return scenes.sort((a, b) => {\n        return a.sceneName.localeCompare(b.sceneName)\n    })\n}\n\nfor (const room of msg.payload.rooms) {\n\n    const scenes = findScenes(room.roomId)\n\n    if (scenes.length > 0) {\n\n        const roomScenes = []\n\n        for (const scene of scenes) {\n\n            roomScenes.push({\n                sceneName: scene.sceneName,\n                sceneId: scene.sceneId\n            })\n        }\n\n        msg.dashboard.push({\n            roomName: room.roomName,\n            roomId: room.roomId,\n            roomScenes: roomScenes\n        })\n    }\n}\n\nmsg.dashboard = msg.dashboard.sort((a, b) => {\n    return a.roomName.localeCompare(b.roomName)\n})\n\ncontext.set('metadata', msg.payload)\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 460,
        "wires": [
            [
                "74c9401c93a5c79f",
                "65477d8ab7384f03"
            ]
        ],
        "info": "Format `rooms` and `scenes` metadata into a combined data structure\nsuitable for use with a `template` node to dynamically create dashboard\ncontrols."
    },
    {
        "id": "eb7123132bce19c7",
        "type": "join",
        "z": "cf1c3c82db18ac13",
        "g": "34cccb636739d850",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 750,
        "y": 460,
        "wires": [
            [
                "de8273a5bd63e29f"
            ]
        ],
        "info": "Join messages containing `rooms` and `scenes` metadata."
    },
    {
        "id": "74c9401c93a5c79f",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "34cccb636739d850",
        "group": "bad6261ac75df85d",
        "name": "Shade Controls",
        "order": 2,
        "width": "6",
        "height": "9",
        "format": "<div style=\"text-align: center;\">\n    <div ng-repeat=\"room in msg.dashboard\">\n        <hr ng-if=\"$index > 0\">\n        <p style=\"font-style:italic\">{{room.roomName}}</p>\n        <md-button style=\"margin: 1px;\" ng-repeat=\"scene in room.roomScenes\"\n            ng-click=\"send({topic:scene.sceneName,payload:scene.sceneId})\">\n            {{scene.sceneName}}\n        </md-button>\n    </div>\n</div>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1100,
        "y": 480,
        "wires": [
            [
                "58b1869eba4f1931"
            ]
        ],
        "info": "Display dynamically created controls on the dashboard."
    },
    {
        "id": "10fd922b445924e9",
        "type": "link in",
        "z": "cf1c3c82db18ac13",
        "g": "34cccb636739d850",
        "name": "powerview metadata",
        "links": [
            "b24fca2d3fa75c5a",
            "adb145cae2d53ba9",
            "78a3fbe808d63c4c",
            "9950e52333199d8f"
        ],
        "x": 655,
        "y": 460,
        "wires": [
            [
                "eb7123132bce19c7"
            ]
        ]
    },
    {
        "id": "58b1869eba4f1931",
        "type": "link out",
        "z": "cf1c3c82db18ac13",
        "g": "34cccb636739d850",
        "name": "shade controls",
        "mode": "link",
        "links": [
            "aed6009fd524f819"
        ],
        "x": 1215,
        "y": 480,
        "wires": []
    },
    {
        "id": "65477d8ab7384f03",
        "type": "link out",
        "z": "cf1c3c82db18ac13",
        "g": "34cccb636739d850",
        "name": "shade model",
        "mode": "link",
        "links": [
            "a669fc8cf545698e"
        ],
        "x": 1035,
        "y": 440,
        "wires": []
    },
    {
        "id": "317090b864c59aa9",
        "type": "link in",
        "z": "cf1c3c82db18ac13",
        "g": "3f10e06bbb25f60e",
        "name": "basement hue controls",
        "links": [
            "d524a793f4547d6e"
        ],
        "x": 735,
        "y": 340,
        "wires": [
            [
                "aede967dabee6adc"
            ]
        ]
    },
    {
        "id": "aede967dabee6adc",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "3f10e06bbb25f60e",
        "group": "2b9d72b934dccd62",
        "name": "Basement Hue Controls",
        "order": 2,
        "width": "6",
        "height": "20",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 890,
        "y": 340,
        "wires": [
            [
                "0c55fa3270a1a251"
            ]
        ]
    },
    {
        "id": "0c55fa3270a1a251",
        "type": "link call",
        "z": "cf1c3c82db18ac13",
        "g": "3f10e06bbb25f60e",
        "name": "",
        "links": [
            "a85248aa620b8480"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1120,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "c57f504fa2665937",
        "type": "link in",
        "z": "cf1c3c82db18ac13",
        "g": "51cc912ae0d47bc5",
        "name": "ground floor hue status",
        "links": [
            "a63d0a103c3194da"
        ],
        "x": 735,
        "y": 160,
        "wires": [
            [
                "312ab67152201b30"
            ]
        ]
    },
    {
        "id": "312ab67152201b30",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "51cc912ae0d47bc5",
        "group": "6865fdd160367b37",
        "name": "Ground Floor Hue readyState",
        "order": 1,
        "width": "6",
        "height": "1",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 910,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "6b6cef6c3f496573",
        "type": "link in",
        "z": "cf1c3c82db18ac13",
        "g": "3f10e06bbb25f60e",
        "name": "basement hue status",
        "links": [
            "0de92d87eea1d6a5"
        ],
        "x": 735,
        "y": 300,
        "wires": [
            [
                "8dd90b562d6eb844"
            ]
        ]
    },
    {
        "id": "8dd90b562d6eb844",
        "type": "ui_template",
        "z": "cf1c3c82db18ac13",
        "g": "3f10e06bbb25f60e",
        "group": "2b9d72b934dccd62",
        "name": "Basement Hue readyState",
        "order": 1,
        "width": "6",
        "height": "1",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 900,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "119b57faaf3571bf",
        "type": "function",
        "z": "cf1c3c82db18ac13",
        "g": "3ee8e4ee3e9c4da0",
        "name": "owntracks model",
        "func": "const model = []\n\nfor (let topic in msg.payload) {\n\n    const message = msg.payload[topic]\n\n    model.push({\n        name: message.name,\n        topic: topic\n    })\n}\n\nmsg.payload = model.sort((a, b) => {\n    return a.name.localeCompare(b.name)\n})\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 620,
        "wires": [
            [
                "67def1a786e36b67",
                "d3576c3839c080a0"
            ]
        ]
    },
    {
        "id": "b8e996d829493cf7",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "",
        "topic": "settings/bedtime",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 140,
        "wires": [
            [
                "da376bc386711c2d"
            ]
        ],
        "info": "Subscribe to `settings/bedtime` messages from the MQTT broker. See the\ndocumentation for the _Bedtime_ dashboard control for more information."
    },
    {
        "id": "aea41299ec309be7",
        "type": "inject",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "01 01 * * *",
        "once": true,
        "onceDelay": "0.1",
        "topic": "daily",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "da376bc386711c2d"
            ]
        ],
        "info": "Send the current timestamp:\n\n1. At start up\n2. Each morning at 1:01AM"
    },
    {
        "id": "2172861d6eca2d1c",
        "type": "join",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 430,
        "y": 120,
        "wires": [
            [
                "ec4c72ab0b8b53ad",
                "cbcdf85a73052db5",
                "b42f1fba69cb70e0"
            ]
        ],
        "info": "Synchronize receipt of `daily/timestamp` and `settings/bedtime`\nmessages."
    },
    {
        "id": "ec4c72ab0b8b53ad",
        "type": "function",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "theme",
        "func": "const date = new Date(msg.payload.daily)\nconst month = date.getMonth() + 1\nconst day = date.getDate()\n\nif ((month == 7) && (day <= 4)) {\n\n    msg.payload = 'tribal'\n\n} else if (month == 10) {\n\n    msg.payload = 'spooky'\n\n} else if (month == 12) {\n\n    msg.payload = 'jolly'\n\n} else {\n\n    msg.payload = 'standard'\n\n}\n\nnode.status({\n    text: msg.payload,\n    shape: 'dot',\n    fill: 'blue'\n})\n\nmsg.topic = 'daily/theme'\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 60,
        "wires": [
            [
                "46ac71815281ccea"
            ]
        ],
        "inputLabels": [
            "daily"
        ],
        "outputLabels": [
            "theme"
        ],
        "info": "Set `msg.payload` to one of the _theme_ values, described below, and\n`msg.topic` to `daily/theme`.\n\n_Note that this `function` node is placed downstream of a `join` in\norder to delay sending MQTT messages until after the connection to the\nbroker has been established; the only input data on which this function\nactually relies comes from the `inject` node which fires once when\nflows start and then every morning at 1AM._\n\n# Input\n\n- timestamp in `msg.payload.daily`\n- all other `msg` properties are ignored\n\n# Output\n\n- `msg.topic` set to `daily/theme`\n- `msg.payload` set to one of the following strings, based on the\n  the timestamp from the input:\n\n| `msg.payload` | Description         |\n|---------------|---------------------|\n| `tribal`      | July 1 - 4          |\n| `spooky`      | Any day in October  |\n| `jolly`       | Any day in December |\n| `standard`    | Any other day       |"
    },
    {
        "id": "cbcdf85a73052db5",
        "type": "function",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "sunrise | sunset",
        "func": "/*global suncalc*/\n\nconst LATITUDE = Number.parseFloat(env.get('LATITUDE'))\nconst LONGITUDE = Number.parseFloat(env.get('LONGITUDE'))\n\nconst sunrise = RED.util.cloneMessage(msg)\nconst sunset = RED.util.cloneMessage(msg)\nconst date = new Date(msg.payload.daily)\n\nconst times = suncalc.getTimes(\n    // work around bug in suncalc\n    new Date(\n        date.getFullYear(),\n        date.getMonth(),\n        date.getDate(),\n        1,\n        1\n    ),\n    LATITUDE,\n    LONGITUDE\n)\n\nsunrise.payload = times.sunrise.getTime()\nsunrise.topic = 'daily/sunrise'\nsunset.payload = times.sunset.getTime()\nsunset.topic = 'daily/sunset'\n\nconst status =\n    new Date(sunrise.payload).toLocaleTimeString() +\n    ' | ' +\n    new Date(sunset.payload).toLocaleTimeString()\n\nnode.status({\n    text: status,\n    shape: 'dot',\n    fill: 'blue'\n})\n\nreturn [sunrise, sunset]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "suncalc",
                "module": "suncalc"
            }
        ],
        "x": 620,
        "y": 120,
        "wires": [
            [
                "46ac71815281ccea"
            ],
            [
                "46ac71815281ccea"
            ]
        ],
        "inputLabels": [
            "daily"
        ],
        "outputLabels": [
            "sunrise",
            "sunset"
        ],
        "info": "Use the [suncalc](https://www.npmjs.com/package/suncalc) package to\nobtain the times at which the sun rises and sets on a given day.\n\n_Note that this `function` node is placed downstream of a `join` in\norder to delay sending MQTT messages until after the connection to the\nbroker has been established; the only input data on which this function\nactually relies comes from the `inject` node which fires once when\nflows start and then every morning at 1AM._\n\n_Note also that this assumes:_\n\n_- `function` nodes are allowed to dynamically load the_ suncalc\n   _package_\n\n_- `${LATITUDE}` and `${LONGITUDE}` environment variables contain the\n  georgraphical coordinates to pass to `suncalc.getTimes()`_\n\n# Input\n\n- timestamp in `msg.payload.daily`\n- all other `msg` properties are ignored\n\n# Output\n\n1. sunrise\n   - `msg.payload` is the timestamp for sunrise as reported by _suncalc_\n   - `msg.topic` is `daily/sunrise`\n2. sunset\n   - `msg.payload` is the timestamp for sunset as reported by _suncalc_\n   - `msg.topic` is `daily/sunset`\n"
    },
    {
        "id": "b42f1fba69cb70e0",
        "type": "function",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "bedtime",
        "func": "const MILLIS_PER_SECOND = 1000\nconst MILLIS_PER_MINUTE = 60 * MILLIS_PER_SECOND\nconst MILLIS_PER_HALF_HOUR = 30 * MILLIS_PER_MINUTE\nconst MILLIS_PER_HOUR = 2 * MILLIS_PER_HALF_HOUR\n\nconst date = new Date(msg.payload.daily)\nconst offset = MILLIS_PER_HALF_HOUR - Math.floor(Math.random() * MILLIS_PER_HOUR)\nconst time = new Date(\n    date.getFullYear(),\n    date.getMonth(),\n    date.getDate(),\n    msg.payload['settings/bedtime']\n).getTime()\n\nmsg.payload = time + offset\n\nnode.status({\n    text: new Date(msg.payload).toLocaleTimeString(),\n    shape: 'dot',\n    fill: 'blue'\n})\n\nmsg.topic = 'daily/bedtime'\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 180,
        "wires": [
            [
                "46ac71815281ccea"
            ]
        ],
        "outputLabels": [
            "bedtime"
        ],
        "info": "Calculate a slightly randomized timestamp based on the values of\n`msg.payload.daily` and `msg.payload.settings/bedtime` as described\nbelow.\n\n# Input\n \n - timestamp for the current day in `msg.payload.daily`\n - value from the `Bedtime` dashboard control in\n   `msg.payload.settings/bedtime`\n- all other `msg` properties are ignored\n\n# Output\n\n- `msg.topic` set to `daily/bedtime`\n- `msg.payload` set to a timestamp as described below\n\n# Details\n\nThis `function` node receives input from a `join` node that combines the\ntimestamp for a given day with a value selected by use of a dropdown\ncontrol on the dashboard. It calculates a random offset of plus or minus\n30 minutes, adds that to the hour specified by the received value in\n`msg.payload.settings/bedtime` and calculates the timestamp for that\nhour on the day specified by the value received in `msg.payload.daily`,\nplacing it in `msg.payload` in the output message.\n"
    },
    {
        "id": "bf9f3e514e81d58c",
        "type": "mqtt out",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "daily/+",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 930,
        "y": 120,
        "wires": [],
        "info": "Broadcast daily event messages using MQTT based on the values of their\n`msg.payload` and `msg.topic` properties."
    },
    {
        "id": "46ac71815281ccea",
        "type": "rbe",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 810,
        "y": 120,
        "wires": [
            [
                "bf9f3e514e81d58c"
            ]
        ],
        "info": "Block messages unless `msg.payload` changes, treating each `msg.topic`\nindependently."
    },
    {
        "id": "da376bc386711c2d",
        "type": "rbe",
        "z": "0b58b958ed2dda42",
        "g": "1858ee0bbe9b4418",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 120,
        "wires": [
            [
                "2172861d6eca2d1c"
            ]
        ],
        "info": "Block messages unless `msg.payload` changes, treating each `msg.topic`\nindependently."
    },
    {
        "id": "ce36e830ccb196af",
        "type": "mqtt out",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "",
        "topic": "timer/time",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 780,
        "y": 300,
        "wires": [],
        "info": "Send the output of the `function` node named `time` as a `timer/time`\nevent using MQTT."
    },
    {
        "id": "449c4612546c24a3",
        "type": "function",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "time",
        "func": "/*global suncalc*/\n\nconst LATITUDE = Number.parseFloat(env.get('LATITUDE'))\nconst LONGITUDE = Number.parseFloat(env.get('LONGITUDE'))\n\nconst now = msg.payload.now\nconst sunrise = msg.payload['daily/sunrise']\nconst sunset = msg.payload['daily/sunset']\nconst bedtime = msg.payload['daily/bedtime']\nconst position = suncalc.getPosition(new Date(now), LATITUDE, LONGITUDE)\n\nif ((now < sunrise) || (now >= bedtime)) {\n\n    msg.payload = 'night'\n\n} else if (now > sunset) {\n\n    msg.payload = 'evening'\n\n} else if (position.altitude > 0.8) {\n\n    msg.payload = 'midday'\n\n} else if (position.azimuth > 0) {\n\n    msg.payload = 'afternoon'\n\n} else {\n\n    msg.payload = 'morning'\n\n}\n\nnode.status({\n    text: msg.payload,\n    shape: 'dot',\n    fill: 'blue'\n})\n\nmsg.topic = 'timer/time'\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "suncalc",
                "module": "suncalc"
            }
        ],
        "x": 530,
        "y": 300,
        "wires": [
            [
                "f901e2f89786bb1d"
            ]
        ],
        "info": "Use the [suncalc](https://www.npmjs.com/package/suncalc) package to\ncalculate a _time_ value, described below, based on the position of\nthe sun.\n\n_Note that this assumes:_\n\n_- `function` nodes are allowed to dynamically load the_ suncalc\n   _package_\n\n_- `${LATITUDE}` and `${LONGITUDE}` environment variables contain the\n  georgraphical coordinates to pass to `suncalc.getPosition()`_\n\n# Input\n\n- timestamp for current minute in `msg.payload.now`\n- timestamp for sunrise in `msg.payload.daily/sunrise`\n- timestamp for sunset in `msg.payload.daily/sunset`\n- timestamp for bedtime in `msg.payload.daily/bedtime`\n- all other `msg` properties are ignored\n\n_See the documentation for the `function` node named `bedtime` for\ninformation on how `msg.payload.daily/bedtime` is calculated._\n\n# Output\n\n- `msg.topic` is `timer/time`\n- `msg.payload` is one of the following strings:\n\n| `msg.payload` | Description                                                                                                                                                             |\n|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| `morning`     | Sunrise to the time at which either the sun is high enough so as not to shine directly into any windows or the sun is no longer shining on the eastern side of the home |\n| `midday`      | Time during which the sun is high enough so as not to shine directly into any windows                                                                                   |\n| `afternoon`   | Time at which the sun is shining on the western side of the home and low enough to shine directly into windows                                                          |\n| `evening`     | Sunset to bedtime                                                                                                                                                       |\n| `night`       | Bedtime to sunrise of the next day                                                                                                                                      |\n\n# Details\n\nThe \"time at which the is high enough so as not to shine directly into\nany windows\" is determined empirically for a home based on its location,\nelevation, orientation, size of awnings or roof overhang and so on.\nBased on that value and the values of `${LATITUDE}` and `${LONGITUDE}`,\nthe sun may not reach such a height on any given day. No messages with\n`msg.payload` set to `midday` will be sent on such occasions.\n\nSimilarly, this function assumes that sunrise and sunset will occur\non the same day and that both will always precede bedtime. These\nassumptions might be violated at certain times of year for extreme\nvalues of `${LATITUDE}`."
    },
    {
        "id": "795ddbf1ece0c9e6",
        "type": "join",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "5",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 410,
        "y": 300,
        "wires": [
            [
                "449c4612546c24a3"
            ]
        ],
        "info": "Synchronize the daily events with the ones sent every minute."
    },
    {
        "id": "dde26fd5b0242b48",
        "type": "rbe",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 290,
        "y": 300,
        "wires": [
            [
                "795ddbf1ece0c9e6"
            ]
        ],
        "info": "Block messages unless `msg.payload` changes, treating each `msg.topic`\nindependently."
    },
    {
        "id": "91c56df5c885cf9f",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "",
        "topic": "daily/+",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 320,
        "wires": [
            [
                "dde26fd5b0242b48"
            ]
        ],
        "info": "Subscribe to all of the daily event messages sent via MQTT."
    },
    {
        "id": "f5730fdb6bc0272f",
        "type": "inject",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "now",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "dde26fd5b0242b48"
            ]
        ],
        "info": "Send a message:\n\n1. At start up\n2. Every 60 seconds thereafter\n\nEach such message will have `msg.payload` set to the timestamp for the\nmoment it was sent and `msg.topic` set to `now`."
    },
    {
        "id": "f901e2f89786bb1d",
        "type": "rbe",
        "z": "0b58b958ed2dda42",
        "g": "1afeb43be3175917",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 650,
        "y": 300,
        "wires": [
            [
                "ce36e830ccb196af"
            ]
        ],
        "info": "Block messages unless `msg.payload` changes, without regard to\n`msg.topic`."
    },
    {
        "id": "42dab2bfc218b7c3",
        "type": "comment",
        "z": "0b58b958ed2dda42",
        "name": "https://www.npmjs.com/package/suncalc",
        "info": "",
        "x": 1040,
        "y": 300,
        "wires": []
    },
    {
        "id": "935f5813b09efe70",
        "type": "comment",
        "z": "0b58b958ed2dda42",
        "name": "assumes ${LATITUDE} and ${LONGITUDE} are defined",
        "info": "",
        "x": 1080,
        "y": 260,
        "wires": []
    },
    {
        "id": "b78ca3870996057b",
        "type": "rbe",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 370,
        "y": 540,
        "wires": [
            [
                "db918aec73c389bf"
            ]
        ],
        "info": "Block messages unless `msg.payload` changes, treating each `msg.topic`\nindependently."
    },
    {
        "id": "db918aec73c389bf",
        "type": "join",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "5",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 490,
        "y": 540,
        "wires": [
            [
                "f7a9a404781d1816"
            ]
        ],
        "info": "Synchronize `settings/shades`, `settings/lighting`, `daily/theme`,\n`timer/time` and `presence/occupied` messages received using MQTT."
    },
    {
        "id": "f7a9a404781d1816",
        "type": "rbe",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 610,
        "y": 540,
        "wires": [
            [
                "1775708d2776c3ea"
            ]
        ],
        "info": "Block unless `msg.payload` changes, irrespective of `msg.topic`."
    },
    {
        "id": "1775708d2776c3ea",
        "type": "mqtt out",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "topic": "automation/trigger",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 770,
        "y": 540,
        "wires": []
    },
    {
        "id": "8d7aa2cb7fd921ec",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "topic": "settings/shades",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 420,
        "wires": [
            [
                "b78ca3870996057b"
            ]
        ]
    },
    {
        "id": "4284d9ac08e3685e",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "topic": "settings/lighting",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 480,
        "wires": [
            [
                "b78ca3870996057b"
            ]
        ]
    },
    {
        "id": "4b4227414715c1fc",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "topic": "daily/theme",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 540,
        "wires": [
            [
                "b78ca3870996057b"
            ]
        ]
    },
    {
        "id": "edd175e6511d1149",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "topic": "timer/time",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 600,
        "wires": [
            [
                "b78ca3870996057b"
            ]
        ]
    },
    {
        "id": "164103646b36c7a9",
        "type": "mqtt in",
        "z": "0b58b958ed2dda42",
        "g": "16d1b9110bd0cbdb",
        "name": "",
        "topic": "presence/occupied",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 660,
        "wires": [
            [
                "b78ca3870996057b"
            ]
        ]
    },
    {
        "id": "37bac7a6b658ade4",
        "type": "switch",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "timer/time",
        "property": "payload.timer/time",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "morning",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "midday",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "afternoon",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "night",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 480,
        "y": 120,
        "wires": [
            [
                "6a9ac472018c38ea"
            ],
            [
                "c8c9c1f0d8b62902"
            ],
            [
                "9e961b1409432775"
            ],
            [
                "db4f7c2c93cd8f30"
            ]
        ],
        "info": "Trigger window shades automation for the `time` specified by the value\nof `msg.payload`."
    },
    {
        "id": "ec730ac674a50f58",
        "type": "link out",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "activate shades scene",
        "mode": "link",
        "links": [
            "689bb9bf9977b2c7",
            "aed6009fd524f819",
            "b52fe8a9c12394e5"
        ],
        "x": 875,
        "y": 120,
        "wires": []
    },
    {
        "id": "6a9ac472018c38ea",
        "type": "change",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "Morning Shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "56393",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 60,
        "wires": [
            [
                "ec730ac674a50f58"
            ]
        ],
        "info": "Set `msg.payload` to the scene id for _Morning Shades_."
    },
    {
        "id": "c8c9c1f0d8b62902",
        "type": "change",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "Open All Shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "7307",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 100,
        "wires": [
            [
                "ec730ac674a50f58"
            ]
        ],
        "info": "Set `msg.payload` to the scene id for _Open All Shades_."
    },
    {
        "id": "9e961b1409432775",
        "type": "change",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "Afternoon Shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "42686",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 140,
        "wires": [
            [
                "ec730ac674a50f58"
            ]
        ],
        "info": "Set `msg.payload` to the scene id for _Afternoon Shades_."
    },
    {
        "id": "db4f7c2c93cd8f30",
        "type": "change",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "Close All Shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "15208",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 180,
        "wires": [
            [
                "ec730ac674a50f58"
            ]
        ],
        "info": "Set `msg.payload` to the scene id for _Close All Shades_."
    },
    {
        "id": "146590f90eed7fb8",
        "type": "mqtt in",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "",
        "topic": "automation/trigger",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 120,
        "wires": [
            [
                "ec26adec2aa94c40"
            ]
        ]
    },
    {
        "id": "ec26adec2aa94c40",
        "type": "switch",
        "z": "448b73182a92925c",
        "g": "5e4f33ee9bb4435b",
        "name": "settings/shades",
        "property": "payload.settings/shades",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 120,
        "wires": [
            [
                "37bac7a6b658ade4"
            ]
        ]
    },
    {
        "id": "aae17e5a30471de5",
        "type": "switch",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "timer/time",
        "property": "payload.timer/time",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "morning",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evening",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "night",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 480,
        "y": 380,
        "wires": [
            [
                "97fb90f6c4a4d450"
            ],
            [
                "0e592700939a92aa"
            ],
            [
                "070b96ef5945e392"
            ]
        ],
        "info": "Trigger window shades automation for the `time` specified by the value\nof `msg.payload.timer/time`."
    },
    {
        "id": "5720dd9348b987ef",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main bathroom nightlight",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"active\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/5d507fb6-89f6-459a-b327-0fffd0c6dc48",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 660,
        "wires": [
            [
                "ece9e398ddf1a6a0"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Main Bathroom_'s _Nightlight_ scene."
    },
    {
        "id": "4e1d20e601e89e22",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main floor nightlight",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/48c39b9f-1599-4a5c-b7f6-bad6cad4029a",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"active\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 700,
        "wires": [
            [
                "ece9e398ddf1a6a0"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Main Floor_ zone's _Nightlight_ scene."
    },
    {
        "id": "ece9e398ddf1a6a0",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "92ec777b2c9dab97"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1010,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "56997e0fe2cc9b78",
        "type": "link in",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard off",
        "links": [],
        "x": 115,
        "y": 700,
        "wires": [
            [
                "cb22b59dd606881c"
            ]
        ]
    },
    {
        "id": "cb22b59dd606881c",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":{\"on\":false}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/grouped_light/bad8480b-b404-42d1-a9e7-a4a69f400971",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 700,
        "wires": [
            [
                "a3e04e2691a74b7b"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill turn off the lights in the _Yard_ \"room\"."
    },
    {
        "id": "a3e04e2691a74b7b",
        "type": "link out",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard off",
        "mode": "return",
        "links": [],
        "x": 315,
        "y": 700,
        "wires": []
    },
    {
        "id": "a1ea5d860b770102",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "56997e0fe2cc9b78"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 800,
        "y": 740,
        "wires": [
            [
                "ece9e398ddf1a6a0"
            ]
        ]
    },
    {
        "id": "bc1635e58a89e806",
        "type": "link in",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main floor sunset",
        "links": [],
        "x": 55,
        "y": 740,
        "wires": [
            [
                "b9d34e86991d2a0a"
            ]
        ]
    },
    {
        "id": "b9d34e86991d2a0a",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main floor sunset",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/6eff0801-01e2-4803-9840-e31c06cee079",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 740,
        "wires": [
            [
                "7a1a8616fdc104f8"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Main Floor_ zone's _Sunset_ scene."
    },
    {
        "id": "7a1a8616fdc104f8",
        "type": "link out",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main floor sunset",
        "mode": "return",
        "links": [],
        "x": 315,
        "y": 740,
        "wires": []
    },
    {
        "id": "6c9be030a00c5cc6",
        "type": "mqtt in",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "topic": "automation/trigger",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 380,
        "wires": [
            [
                "ab22f57d983c0a67"
            ]
        ]
    },
    {
        "id": "0e592700939a92aa",
        "type": "switch",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "daily/theme",
        "property": "payload.daily/theme",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "tribal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "spooky",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "jolly",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 670,
        "y": 380,
        "wires": [
            [
                "ad19b78d51cf3749"
            ],
            [
                "3c78c5af028bd8f2"
            ],
            [
                "a06d578214f0220e"
            ],
            [
                "01299c560124a4a8"
            ]
        ],
        "info": "Trigger evening lighting automation for the specified _theme_."
    },
    {
        "id": "74c4f1b645e19b49",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard spooky",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/70a0a8a6-b4b7-4b24-a9cf-0ecea0f359cc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 360,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Yard_ \"room's\" _Spooky_ scene."
    },
    {
        "id": "6a90a040ad69d3e3",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard sunset",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/9b6935e2-f8ed-4f91-83a2-2bff1850da99",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 560,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Yard_ \"room's\" _Sunset_ scene."
    },
    {
        "id": "9368a43e0385a4cd",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main floor jolly",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/3ac45cbb-21c0-4c2f-8037-c40345537ce2",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 460,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Main Floor_ zone's _Sunset_ scene."
    },
    {
        "id": "81a28a8be63c7133",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard jolly",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/12571f23-7714-4b47-8e75-a3040389b788",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 420,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Yard_ \"room's\" _Jolly_ scene."
    },
    {
        "id": "e8e26ac6a6ffd8f7",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "92ec777b2c9dab97"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1230,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "ee5934ee53003d6d",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "bc1635e58a89e806"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 930,
        "y": 320,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ]
    },
    {
        "id": "2b807830184aa01f",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "bc1635e58a89e806"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 930,
        "y": 520,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ]
    },
    {
        "id": "15bd957df9108fdf",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "yard tribal",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/c4681d32-3368-43cd-9cf1-436132521068",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 220,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill activate the _Yard_ \"room's\" _Tribal_ scene."
    },
    {
        "id": "026fcd605d0c149f",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "bc1635e58a89e806"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 930,
        "y": 260,
        "wires": [
            [
                "e8e26ac6a6ffd8f7"
            ]
        ]
    },
    {
        "id": "6312bc963e5b2aa0",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "56997e0fe2cc9b78"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 760,
        "y": 60,
        "wires": [
            [
                "124fdb28f37e82ee"
            ]
        ]
    },
    {
        "id": "2d846e7736508ab1",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main floor off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/grouped_light/9c1c7975-2f47-4552-bac8-c19b643cd678",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":{\"on\":false}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 100,
        "wires": [
            [
                "124fdb28f37e82ee"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill turn off the lights in the _Main Floor_ zone."
    },
    {
        "id": "ea66991dc8d241d9",
        "type": "change",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "main bathroom off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":{\"on\":false}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/grouped_light/aea74e74-d544-4d08-ad71-3b6665045256",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 140,
        "wires": [
            [
                "124fdb28f37e82ee"
            ]
        ],
        "info": "Set `msg.topic`, `msg.payload` and `msg.method` to the values that\nwill turn off the lights in the _Main Bathroom_."
    },
    {
        "id": "124fdb28f37e82ee",
        "type": "link call",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "",
        "links": [
            "92ec777b2c9dab97"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 970,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "ab22f57d983c0a67",
        "type": "switch",
        "z": "d5996bce439cae5a",
        "g": "60e4d1c056ed3a0c",
        "name": "settings/lighting",
        "property": "payload.settings/lighting",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 380,
        "wires": [
            [
                "aae17e5a30471de5"
            ]
        ]
    },
    {
        "id": "70e42b6637f4c865",
        "type": "delay",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": true,
        "outputs": 1,
        "x": 170,
        "y": 80,
        "wires": [
            [
                "413305fe8cf8bc16"
            ]
        ],
        "info": "Limit the rate at which messages are sent to the PowerView hub to 1 per\nsecond."
    },
    {
        "id": "413305fe8cf8bc16",
        "type": "http request",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 330,
        "y": 80,
        "wires": [
            [
                "3b9aea255e25c86d",
                "450c11f088a3f9ee"
            ]
        ],
        "info": "Send `msg.url` as a `GET` request to the PowerView hub."
    },
    {
        "id": "3b9aea255e25c86d",
        "type": "function",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "validate",
        "func": "let fill = 'green'\n\ntry {\n\n    if ((typeof msg.statusCode) != 'number') {\n\n        fill = 'red'\n        return msg\n\n    }\n\n    if ((msg.statusCode < 200) || (msg.statusCode >= 300)) {\n\n        fill = 'red'\n        return msg\n\n    }\n\n    if (msg.statusCode != 200) {\n\n        fill = 'yellow'\n\n    }\n\n    return null\n\n} finally {\n\n    node.status({\n        text: msg.statusCode,\n        shape: 'dot',\n        fill: fill\n    })\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 100,
        "wires": [
            [
                "e0ad652b11e93160",
                "d27eec8b029c5bd5"
            ]
        ],
        "outputLabels": [
            "success"
        ],
        "info": "Block unless the response indicates an error occurred."
    },
    {
        "id": "450c11f088a3f9ee",
        "type": "link out",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "powerview response",
        "mode": "return",
        "links": [],
        "x": 435,
        "y": 60,
        "wires": []
    },
    {
        "id": "a250d71416af8250",
        "type": "link in",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "send to powerview",
        "links": [],
        "x": 55,
        "y": 80,
        "wires": [
            [
                "70e42b6637f4c865"
            ]
        ]
    },
    {
        "id": "02eb116aa3a7efad",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'http://' & $env('POWERVIEW_ADDRESS') & '/api/scenes/'",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 220,
        "wires": [
            [
                "a2ce2f10f0cbc3b4"
            ]
        ],
        "info": "Set `msg.url` to request the list of scenes from the PowerView hub."
    },
    {
        "id": "a2ce2f10f0cbc3b4",
        "type": "link call",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "links": [
            "a250d71416af8250"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 220,
        "wires": [
            [
                "4597056c8e33d1d2"
            ]
        ]
    },
    {
        "id": "4597056c8e33d1d2",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "sceneData",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.sceneData",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 220,
        "wires": [
            [
                "a4b2cb7314b93cec"
            ]
        ],
        "info": "Set `msg.payload` to `msg.payload.sceneData`."
    },
    {
        "id": "a4b2cb7314b93cec",
        "type": "split",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 790,
        "y": 220,
        "wires": [
            [
                "e89d138990a2c571"
            ]
        ],
        "info": "Divide array into a sequence of individual messages."
    },
    {
        "id": "e89d138990a2c571",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "scene",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"sceneName\":$base64decode(payload.name),\"sceneId\":payload.id,\"roomId\":payload.roomId}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 220,
        "wires": [
            [
                "09ed6328f31946db"
            ]
        ],
        "info": "Extract the salient metadata into `msg.payload`."
    },
    {
        "id": "09ed6328f31946db",
        "type": "join",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1030,
        "y": 220,
        "wires": [
            [
                "ca455aa5752d94d8"
            ]
        ],
        "info": "Join previously split messages back into an array."
    },
    {
        "id": "a4115f1a663ecf84",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'http://' & $env('POWERVIEW_ADDRESS') & '/api/rooms/'",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 260,
        "wires": [
            [
                "b3fa2dd0b396e5ba"
            ]
        ],
        "info": "Set `msg.url` to request the list of room from the PowerView hub."
    },
    {
        "id": "b3fa2dd0b396e5ba",
        "type": "link call",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "links": [
            "a250d71416af8250"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 260,
        "wires": [
            [
                "7379bd9759e06a98"
            ]
        ]
    },
    {
        "id": "7379bd9759e06a98",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "roomData",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.roomData",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 260,
        "wires": [
            [
                "fa994326c2180556"
            ]
        ],
        "info": "Set `msg.payload` to `msg.payload.roomData`."
    },
    {
        "id": "fa994326c2180556",
        "type": "split",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 790,
        "y": 260,
        "wires": [
            [
                "97d89691a9505bb9"
            ]
        ],
        "info": "Divide array into a sequence of individual messages."
    },
    {
        "id": "97d89691a9505bb9",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "room",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"roomName\":$base64decode(payload.name),\"roomId\":payload.id}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 260,
        "wires": [
            [
                "23ce9cde77523965"
            ]
        ],
        "info": "Extract the salient metadata into `msg.payload`."
    },
    {
        "id": "23ce9cde77523965",
        "type": "join",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1030,
        "y": 260,
        "wires": [
            [
                "b3b32f662f388893"
            ]
        ],
        "info": "Join previously split messages back into an array."
    },
    {
        "id": "ca455aa5752d94d8",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "scenes",
                "tot": "str",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 220,
        "wires": [
            [
                "78a3fbe808d63c4c"
            ]
        ],
        "info": "Set `msg.topic` to `scenes`."
    },
    {
        "id": "78a3fbe808d63c4c",
        "type": "link out",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "get rooms",
        "mode": "link",
        "links": [
            "b6e07b7b99531b02",
            "10fd922b445924e9"
        ],
        "x": 1275,
        "y": 220,
        "wires": []
    },
    {
        "id": "9950e52333199d8f",
        "type": "link out",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "powerview metadata",
        "mode": "link",
        "links": [
            "b6e07b7b99531b02",
            "10fd922b445924e9"
        ],
        "x": 1275,
        "y": 260,
        "wires": []
    },
    {
        "id": "b3b32f662f388893",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "rooms",
                "tot": "str",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 260,
        "wires": [
            [
                "9950e52333199d8f"
            ]
        ],
        "info": "Set `msg.topic` to `rooms`."
    },
    {
        "id": "57c39b659f421513",
        "type": "mqtt in",
        "z": "dcb190a34f9985d0",
        "g": "74348749d23b9082",
        "name": "",
        "topic": "controls/refresh",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 240,
        "wires": [
            [
                "02eb116aa3a7efad",
                "a4115f1a663ecf84"
            ]
        ],
        "info": "Subscribe to `controls/refresh` messages using MQTT."
    },
    {
        "id": "9b22e1e38e67938b",
        "type": "comment",
        "z": "dcb190a34f9985d0",
        "name": "https://motorisation.hde.nl/hd/powerview/general-guides/API/",
        "info": "",
        "x": 260,
        "y": 380,
        "wires": []
    },
    {
        "id": "e685110a1eb864fd",
        "type": "comment",
        "z": "dcb190a34f9985d0",
        "name": "assumes ${POWERVIEW_ADDRESS} is defined",
        "info": "",
        "x": 220,
        "y": 340,
        "wires": []
    },
    {
        "id": "aed6009fd524f819",
        "type": "link in",
        "z": "dcb190a34f9985d0",
        "g": "9cf0457b813ca743",
        "name": "activate powerview scene",
        "links": [
            "58b1869eba4f1931",
            "ec730ac674a50f58"
        ],
        "x": 895,
        "y": 360,
        "wires": [
            [
                "34eaa776ddc24669"
            ]
        ],
        "info": "// nrlint align-to-grid:off\n"
    },
    {
        "id": "34eaa776ddc24669",
        "type": "change",
        "z": "dcb190a34f9985d0",
        "g": "9cf0457b813ca743",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'http://' & $env('POWERVIEW_ADDRESS') & '/api/scenes?sceneId=' & payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 360,
        "wires": [
            [
                "2bf099ec37e84bbc"
            ]
        ],
        "info": "Set `msg.url` to the URL with query string to activate the scene\nspecified by `msg.payload` using the IP address specified by the\nenvironment variable named `POWERVIEW_ADDRESS`."
    },
    {
        "id": "2bf099ec37e84bbc",
        "type": "link call",
        "z": "dcb190a34f9985d0",
        "g": "9cf0457b813ca743",
        "name": "",
        "links": [
            "a250d71416af8250"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1190,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "d27eec8b029c5bd5",
        "type": "function",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "stringify",
        "func": "msg.payload = JSON.stringify(msg, undefined, 1)\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 80,
        "wires": [
            [
                "9f3e418cab152ae3"
            ]
        ],
        "info": "Pretty-print `msg.payload`."
    },
    {
        "id": "9f3e418cab152ae3",
        "type": "template",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "<pre>",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<div>\n    <pre>{{payload}}</pre>\n</div>",
        "output": "str",
        "x": 750,
        "y": 80,
        "wires": [
            [
                "1b3072d1d7c8560b"
            ]
        ],
        "info": "Wrap `msg.payload` in HTML."
    },
    {
        "id": "1b3072d1d7c8560b",
        "type": "ui_toast",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "",
        "x": 890,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "e0ad652b11e93160",
        "type": "debug",
        "z": "dcb190a34f9985d0",
        "g": "eaaca1e226cc9251",
        "name": "powerview error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 120,
        "wires": []
    },
    {
        "id": "168247b3760f4731",
        "type": "subflow:b903e4fc563d501c",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "KEY",
                "type": "env"
            },
            {
                "name": "TARGET",
                "value": "TARGET",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "TOPIC",
                "type": "env"
            }
        ],
        "x": 410,
        "y": 140,
        "wires": [
            [
                "06948582458b59fd"
            ],
            [
                "0ba95e35bb2d883c"
            ],
            [
                "a63d0a103c3194da"
            ]
        ]
    },
    {
        "id": "92ec777b2c9dab97",
        "type": "link in",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "send to ground floor hue",
        "links": [],
        "x": 295,
        "y": 140,
        "wires": [
            [
                "168247b3760f4731"
            ]
        ]
    },
    {
        "id": "1fa12506e964418e",
        "type": "subflow:b903e4fc563d501c",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "KEY",
                "type": "env"
            },
            {
                "name": "TARGET",
                "value": "TARGET",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "TOPIC",
                "type": "env"
            }
        ],
        "x": 410,
        "y": 360,
        "wires": [
            [
                "d524a793f4547d6e"
            ],
            [
                "05602f33073e8a40"
            ],
            [
                "0de92d87eea1d6a5"
            ]
        ]
    },
    {
        "id": "a85248aa620b8480",
        "type": "link in",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "send to basement hue",
        "links": [],
        "x": 295,
        "y": 360,
        "wires": [
            [
                "1fa12506e964418e"
            ]
        ]
    },
    {
        "id": "0a00d4bcdcfab828",
        "type": "comment",
        "z": "0fd18332ac97df78",
        "name": "https://github.com/parasaurolophus/create-hue-application-key",
        "info": "",
        "x": 260,
        "y": 520,
        "wires": []
    },
    {
        "id": "caacce91266c1b21",
        "type": "comment",
        "z": "0fd18332ac97df78",
        "name": "https://developers.meethue.com/develop/hue-api-v2/",
        "info": "",
        "x": 230,
        "y": 480,
        "wires": []
    },
    {
        "id": "a6c65b71fb515b1e",
        "type": "comment",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "assumes ${GROUND_FLOOR_HUE_ADDRESS} and ${GROUND_FLOOR_HUE_KEY} are defined",
        "info": "",
        "x": 380,
        "y": 60,
        "wires": []
    },
    {
        "id": "02f4c8bc756ccb0c",
        "type": "comment",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "send to ground floor hue ->",
        "info": "",
        "x": 150,
        "y": 140,
        "wires": []
    },
    {
        "id": "3c8bdad58be0a70d",
        "type": "comment",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "send to basement hue ->",
        "info": "",
        "x": 150,
        "y": 360,
        "wires": []
    },
    {
        "id": "603def2442931ab8",
        "type": "comment",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "assumes ${BASEMENT_HUE_ADDRESS} and ${BASEMENT_HUE_KEY} are defined",
        "info": "",
        "x": 340,
        "y": 280,
        "wires": []
    },
    {
        "id": "0ba95e35bb2d883c",
        "type": "link out",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "ground floor hue metadata",
        "mode": "link",
        "links": [
            "7e752d52587770b0"
        ],
        "x": 535,
        "y": 140,
        "wires": []
    },
    {
        "id": "a63d0a103c3194da",
        "type": "link out",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "ground floor hue status",
        "mode": "link",
        "links": [
            "c57f504fa2665937"
        ],
        "x": 535,
        "y": 180,
        "wires": []
    },
    {
        "id": "06948582458b59fd",
        "type": "link out",
        "z": "0fd18332ac97df78",
        "g": "8669233b567d0ffd",
        "name": "ground floor hue controls",
        "mode": "link",
        "links": [
            "093e3d281d19a300"
        ],
        "x": 535,
        "y": 100,
        "wires": []
    },
    {
        "id": "d524a793f4547d6e",
        "type": "link out",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "basement hue controls",
        "mode": "link",
        "links": [
            "317090b864c59aa9"
        ],
        "x": 535,
        "y": 320,
        "wires": []
    },
    {
        "id": "05602f33073e8a40",
        "type": "link out",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "basement hue metadata",
        "mode": "link",
        "links": [
            "88c84a36afd0a577"
        ],
        "x": 535,
        "y": 360,
        "wires": []
    },
    {
        "id": "0de92d87eea1d6a5",
        "type": "link out",
        "z": "0fd18332ac97df78",
        "g": "4cb1a57dd2d304af",
        "name": "basement hue status",
        "mode": "link",
        "links": [
            "6b6cef6c3f496573"
        ],
        "x": 535,
        "y": 400,
        "wires": []
    },
    {
        "id": "0fb98b609a89f6fa",
        "type": "mqtt in",
        "z": "aa89d7a203abe260",
        "g": "8b901043dfb1d703",
        "name": "",
        "topic": "owntracks/+/+",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 180,
        "wires": [
            [
                "685f6658f1b43a67"
            ]
        ]
    },
    {
        "id": "685f6658f1b43a67",
        "type": "switch",
        "z": "aa89d7a203abe260",
        "g": "8b901043dfb1d703",
        "name": "location",
        "property": "payload._type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "location",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 180,
        "wires": [
            [
                "6fea95222365c815"
            ]
        ]
    },
    {
        "id": "7a7f46654fea15c0",
        "type": "comment",
        "z": "aa89d7a203abe260",
        "name": "https://owntracks.org/booklet/",
        "info": "",
        "x": 720,
        "y": 80,
        "wires": []
    },
    {
        "id": "d0d14087ca166308",
        "type": "comment",
        "z": "aa89d7a203abe260",
        "name": "assumes owntracks is configured with a region named \"Home|1|2\" on each occupant's device",
        "info": "",
        "x": 920,
        "y": 40,
        "wires": []
    },
    {
        "id": "6fea95222365c815",
        "type": "function",
        "z": "aa89d7a203abe260",
        "g": "8b901043dfb1d703",
        "name": "present",
        "func": "const date = new Date(msg.payload.tst * 1000)\nconst inregions = msg.payload.inregions || []\n\nmsg.payload.present = inregions.includes('Home|1|2')\nmsg.payload.date = date.toLocaleDateString()\nmsg.payload.time = date.toLocaleTimeString()\nmsg.payload.name = msg.payload.tid\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 180,
        "wires": [
            [
                "97929054211fde5f",
                "e55d94f2e2ad19b4"
            ]
        ]
    },
    {
        "id": "19dcdf7d30223dca",
        "type": "rbe",
        "z": "aa89d7a203abe260",
        "g": "d9442a5bf6d149a3",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 60,
        "wires": [
            [
                "d36a88f8fd2b4a57"
            ]
        ]
    },
    {
        "id": "d36a88f8fd2b4a57",
        "type": "mqtt out",
        "z": "aa89d7a203abe260",
        "g": "d9442a5bf6d149a3",
        "name": "",
        "topic": "presence/occupied",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "cebfc098dc83e835",
        "x": 470,
        "y": 60,
        "wires": []
    },
    {
        "id": "f0eb117cc0bc558d",
        "type": "function",
        "z": "aa89d7a203abe260",
        "g": "d9442a5bf6d149a3",
        "name": "occupied",
        "func": "let occupied = false\n\nfor (let topic in msg.payload) {\n\n    const message = msg.payload[topic]\n\n    if (message.present) {\n\n        occupied = true\n        break\n\n    }\n}\n\nmsg.payload = occupied\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 60,
        "wires": [
            [
                "19dcdf7d30223dca"
            ]
        ]
    },
    {
        "id": "97929054211fde5f",
        "type": "join",
        "z": "aa89d7a203abe260",
        "g": "8b901043dfb1d703",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "1",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 550,
        "y": 160,
        "wires": [
            [
                "fa2e24914da356c4"
            ]
        ]
    },
    {
        "id": "fa2e24914da356c4",
        "type": "link out",
        "z": "aa89d7a203abe260",
        "g": "8b901043dfb1d703",
        "name": "joined",
        "mode": "link",
        "links": [
            "8c1c48679ffd613a",
            "8d1539c58c9952e5",
            "2d1e1ef04c254fc7",
            "0a276a2f80958e1d"
        ],
        "x": 635,
        "y": 160,
        "wires": []
    },
    {
        "id": "8d1539c58c9952e5",
        "type": "link in",
        "z": "aa89d7a203abe260",
        "g": "d9442a5bf6d149a3",
        "name": "presence",
        "links": [
            "fa2e24914da356c4",
            "a493346ae9aca541"
        ],
        "x": 75,
        "y": 60,
        "wires": [
            [
                "f0eb117cc0bc558d"
            ]
        ]
    },
    {
        "id": "e55d94f2e2ad19b4",
        "type": "link out",
        "z": "aa89d7a203abe260",
        "g": "8b901043dfb1d703",
        "name": "present",
        "mode": "link",
        "links": [
            "fe7c5bfae8e28782",
            "ec43fab9ca3811b0"
        ],
        "x": 515,
        "y": 200,
        "wires": []
    },
    {
        "id": "276c2f875af67ff4",
        "type": "worldmap in",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "",
        "path": "/worldmap",
        "events": "connect",
        "x": 120,
        "y": 340,
        "wires": [
            [
                "35b218d3b52509fd"
            ]
        ]
    },
    {
        "id": "35b218d3b52509fd",
        "type": "join",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 250,
        "y": 320,
        "wires": [
            [
                "99d49d9fa9a4b7b9"
            ]
        ]
    },
    {
        "id": "99d49d9fa9a4b7b9",
        "type": "change",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "delete worldmap",
        "rules": [
            {
                "t": "delete",
                "p": "payload.worldmap",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 320,
        "wires": [
            [
                "13221e9154949946"
            ]
        ]
    },
    {
        "id": "13221e9154949946",
        "type": "split",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "topic",
        "x": 550,
        "y": 320,
        "wires": [
            [
                "96b8c82fdeb0cc61"
            ]
        ]
    },
    {
        "id": "96b8c82fdeb0cc61",
        "type": "switch",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "_sessionid",
        "property": "$exists(_sessionid)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 320,
        "wires": [
            [
                "71ce3f29ea878e53"
            ]
        ]
    },
    {
        "id": "71ce3f29ea878e53",
        "type": "change",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "zoom",
        "rules": [
            {
                "t": "set",
                "p": "payload.command",
                "pt": "msg",
                "to": "{\"zoom\":18}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 320,
        "wires": [
            [
                "ebe4d9baab41f78e"
            ]
        ]
    },
    {
        "id": "ebe4d9baab41f78e",
        "type": "worldmap",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "",
        "lat": "",
        "lon": "",
        "zoom": "",
        "layer": "OSMG",
        "cluster": "",
        "maxage": "",
        "usermenu": "show",
        "layers": "show",
        "panit": "true",
        "panlock": "false",
        "zoomlock": "false",
        "hiderightclick": "false",
        "coords": "none",
        "showgrid": "false",
        "showruler": "false",
        "allowFileDrop": "false",
        "path": "/worldmap",
        "overlist": "DR,CO,RA,DN,HM",
        "maplist": "OSMG,OSMC,EsriC,EsriS,EsriT,EsriDG,OpTop",
        "mapname": "",
        "mapurl": "",
        "mapopt": "",
        "mapwms": false,
        "x": 960,
        "y": 320,
        "wires": []
    },
    {
        "id": "ec43fab9ca3811b0",
        "type": "link in",
        "z": "aa89d7a203abe260",
        "g": "1b79bfde24d7c96e",
        "name": "present",
        "links": [
            "4adc4e911e65c64a",
            "e55d94f2e2ad19b4"
        ],
        "x": 165,
        "y": 300,
        "wires": [
            [
                "35b218d3b52509fd"
            ]
        ],
        "info": "// nrlint align-to-grid:off\n"
    },
    {
        "id": "62646295b2e7d915",
        "type": "mqtt in",
        "z": "aa89d7a203abe260",
        "g": "9afb63c1c8bd4737",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 570,
        "y": 440,
        "wires": [
            [
                "206ca94c86f8c312"
            ]
        ]
    },
    {
        "id": "81782b142dd085ec",
        "type": "switch",
        "z": "aa89d7a203abe260",
        "g": "9afb63c1c8bd4737",
        "name": "connected",
        "property": "status.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "node-red:common.status.connected",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 290,
        "y": 440,
        "wires": [
            [
                "3db6b246859868ee"
            ]
        ]
    },
    {
        "id": "4b56ea14719d7d6a",
        "type": "status",
        "z": "aa89d7a203abe260",
        "d": true,
        "g": "9afb63c1c8bd4737",
        "name": "status: mqtt in",
        "scope": [
            "62646295b2e7d915"
        ],
        "x": 130,
        "y": 440,
        "wires": [
            [
                "81782b142dd085ec"
            ]
        ]
    },
    {
        "id": "206ca94c86f8c312",
        "type": "rbe",
        "z": "aa89d7a203abe260",
        "g": "9afb63c1c8bd4737",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 690,
        "y": 440,
        "wires": [
            [
                "03536dd6672f267f"
            ]
        ]
    },
    {
        "id": "3db6b246859868ee",
        "type": "change",
        "z": "aa89d7a203abe260",
        "g": "9afb63c1c8bd4737",
        "name": "subscribe",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "subscribe",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "$map(\t   $split($env('OWNTRACKS_TOPICS'), ':'),\t   function($topic) {\t       { \"topic\": $topic, \"qos\": 2 }\t   }\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 440,
        "wires": [
            [
                "62646295b2e7d915"
            ]
        ]
    },
    {
        "id": "03536dd6672f267f",
        "type": "debug",
        "z": "aa89d7a203abe260",
        "g": "9afb63c1c8bd4737",
        "name": "owntracks",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "counter",
        "x": 820,
        "y": 440,
        "wires": []
    },
    {
        "id": "7b9c4782e27fd2a6",
        "type": "ui_template",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "group": "6432938dc45a0f1b",
        "name": "Owntracks",
        "order": 0,
        "width": "6",
        "height": "24",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 490,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "0a276a2f80958e1d",
        "type": "link in",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "name": "owntracks events",
        "links": [
            "fa2e24914da356c4",
            "a493346ae9aca541"
        ],
        "x": 235,
        "y": 580,
        "wires": [
            [
                "18026fe8357838ab"
            ]
        ]
    },
    {
        "id": "dedc6f621fe92832",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "daily/theme",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 120,
        "wires": [
            [
                "fd0c567c69283354"
            ]
        ]
    },
    {
        "id": "5c5154d5bead461b",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "daily/sunrise",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 180,
        "wires": [
            [
                "6293131f50765462"
            ]
        ]
    },
    {
        "id": "fa34b76e712ef007",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "daily/sunset",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 240,
        "wires": [
            [
                "18d43f9fefe9624c"
            ]
        ]
    },
    {
        "id": "9130997453dbb01b",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "daily/bedtime",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 300,
        "wires": [
            [
                "0b56b8c38bfb3aba"
            ]
        ]
    },
    {
        "id": "9dbd2d38d6ceec1c",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "timer/time",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 100,
        "y": 360,
        "wires": [
            [
                "1c34f9e60db8ac44"
            ]
        ]
    },
    {
        "id": "fd0c567c69283354",
        "type": "ui_text",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Theme",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 260,
        "y": 120,
        "wires": []
    },
    {
        "id": "4001688ace8380e3",
        "type": "ui_text",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Sunrise",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 420,
        "y": 180,
        "wires": []
    },
    {
        "id": "e5d69dd29b21c14c",
        "type": "ui_text",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Sunset",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 420,
        "y": 240,
        "wires": []
    },
    {
        "id": "518d5b3b737fb2b7",
        "type": "ui_text",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Bedtime",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 420,
        "y": 300,
        "wires": []
    },
    {
        "id": "1c34f9e60db8ac44",
        "type": "ui_text",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "order": 6,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Time",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 230,
        "y": 360,
        "wires": []
    },
    {
        "id": "f71d8c10fe85ef58",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "automation/trigger",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 480,
        "wires": [
            [
                "92c3731c8de659b7"
            ]
        ]
    },
    {
        "id": "8157178701101806",
        "type": "ui_template",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "name": "Trigger Automation",
        "order": 8,
        "width": "6",
        "height": "5",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 470,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "33f3b49c352439c5",
        "type": "mqtt in",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "topic": "presence/occupied",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "cebfc098dc83e835",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 60,
        "wires": [
            [
                "a82e890fa79b420b"
            ]
        ]
    },
    {
        "id": "a82e890fa79b420b",
        "type": "ui_text",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Occupied",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 300,
        "y": 60,
        "wires": []
    },
    {
        "id": "7e752d52587770b0",
        "type": "link in",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "name": "ground floor hue metadata",
        "links": [
            "0ba95e35bb2d883c"
        ],
        "x": 235,
        "y": 660,
        "wires": [
            [
                "ad2e21f102e390a2"
            ]
        ]
    },
    {
        "id": "ad2e21f102e390a2",
        "type": "ui_template",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "group": "572765d576e80a9f",
        "name": "Ground Floor Hue Metadata",
        "order": 1,
        "width": "6",
        "height": "85",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "a669fc8cf545698e",
        "type": "link in",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "name": "shade metadata",
        "links": [
            "65477d8ab7384f03"
        ],
        "x": 235,
        "y": 620,
        "wires": [
            [
                "ef07dd563fbd8f3f"
            ]
        ]
    },
    {
        "id": "ef07dd563fbd8f3f",
        "type": "ui_template",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "group": "9c75181f2c63c679",
        "name": "Shades Metadata",
        "order": 2,
        "width": "6",
        "height": "12",
        "format": "<div>\n    <div ng-repeat=\"room in msg.dashboard\">\n        <hr ng-if=\"$index > 0\">\n        <p style=\"font-style: italic;\">{{room.roomName}}</p>\n        <p>{{room.roomId}}</p>\n        <ul>\n            <li ng-repeat=\"scene in room.roomScenes\">\n                <span style=\"font-style: italic;\">{{scene.sceneName}}</span>\n                <br>\n                {{scene.sceneId}}\n            </li>\n        </ul>\n    </div>\n</div>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 370,
        "y": 620,
        "wires": [
            []
        ],
        "info": "Display dynamically created controls on the dashboard."
    },
    {
        "id": "88c84a36afd0a577",
        "type": "link in",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "name": "basement hue metadata",
        "links": [
            "05602f33073e8a40"
        ],
        "x": 235,
        "y": 700,
        "wires": [
            [
                "25d4e7cf8ec7c009"
            ]
        ]
    },
    {
        "id": "25d4e7cf8ec7c009",
        "type": "ui_template",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "group": "b92e09ec548c4465",
        "name": "Basement Hue Metadata",
        "order": 1,
        "width": "6",
        "height": "47",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 390,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "a7cf1643a9332de2",
        "type": "link in",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "locale string",
        "links": [],
        "x": 655,
        "y": 60,
        "wires": [
            [
                "3bf82acf8b05bc31"
            ]
        ]
    },
    {
        "id": "3bf82acf8b05bc31",
        "type": "function",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "locale string",
        "func": "msg.payload = new Date(msg.payload).toLocaleString()\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 60,
        "wires": [
            [
                "1af506ce07ba6b16"
            ]
        ],
        "info": "Replace the timestamp in `msg.payload` with its localized string\nrepresentation."
    },
    {
        "id": "1af506ce07ba6b16",
        "type": "link out",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "locale string",
        "mode": "return",
        "links": [],
        "x": 875,
        "y": 60,
        "wires": []
    },
    {
        "id": "6293131f50765462",
        "type": "link call",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "links": [
            "a7cf1643a9332de2"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 270,
        "y": 180,
        "wires": [
            [
                "4001688ace8380e3"
            ]
        ]
    },
    {
        "id": "18d43f9fefe9624c",
        "type": "link call",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "links": [
            "a7cf1643a9332de2"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 270,
        "y": 240,
        "wires": [
            [
                "e5d69dd29b21c14c"
            ]
        ]
    },
    {
        "id": "0b56b8c38bfb3aba",
        "type": "link call",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "links": [
            "a7cf1643a9332de2"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 270,
        "y": 300,
        "wires": [
            [
                "518d5b3b737fb2b7"
            ]
        ]
    },
    {
        "id": "43dededbad742ab8",
        "type": "link in",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "stringify",
        "links": [],
        "x": 655,
        "y": 100,
        "wires": [
            [
                "749b3deee816e422"
            ]
        ]
    },
    {
        "id": "749b3deee816e422",
        "type": "function",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "stringify",
        "func": "msg.now = new Date().toLocaleString()\nmsg.payload = JSON.stringify(msg.payload, undefined, 1)\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 100,
        "wires": [
            [
                "b999ac0934b6f741"
            ]
        ]
    },
    {
        "id": "b999ac0934b6f741",
        "type": "template",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<div>\n    <p style=\"text-align: center;font-style: italic;\">{{now}}</p>\n    <p style=\"text-align: center; font-weight: bold;\">{{topic}}</p>\n    <pre>{{payload}}</pre>\n</div>",
        "output": "str",
        "x": 900,
        "y": 100,
        "wires": [
            [
                "7a0af6f4a758942f"
            ]
        ]
    },
    {
        "id": "7a0af6f4a758942f",
        "type": "link out",
        "z": "df241ac327af880e",
        "g": "06bdd60cce319536",
        "name": "stringify",
        "mode": "return",
        "links": [],
        "x": 995,
        "y": 100,
        "wires": []
    },
    {
        "id": "92c3731c8de659b7",
        "type": "link call",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "name": "",
        "links": [
            "43dededbad742ab8"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 300,
        "y": 480,
        "wires": [
            [
                "8157178701101806"
            ]
        ]
    },
    {
        "id": "18026fe8357838ab",
        "type": "link call",
        "z": "df241ac327af880e",
        "g": "08b2209541523df5",
        "name": "",
        "links": [
            "43dededbad742ab8"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 340,
        "y": 580,
        "wires": [
            [
                "7b9c4782e27fd2a6"
            ]
        ]
    },
    {
        "id": "fc153f56d0c419cf",
        "type": "ui_template",
        "z": "df241ac327af880e",
        "g": "09d28341f4c50b5b",
        "group": "62fb9b437a9f6bcf",
        "name": "Separator",
        "order": 7,
        "width": "6",
        "height": "1",
        "format": "<div>\n    <hr>\n</div>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 100,
        "y": 420,
        "wires": [
            []
        ]
    }
]